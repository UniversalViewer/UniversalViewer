import{a as Ht,c as bt,e as Et,f as Bt}from"./chunk-JVQXRAW4.js";import{a as Mt,b as R,d as K,g as wt,j as vt,k as Pt,l as V,m as ht,n as Nt,o as j,p as E}from"./chunk-4W27INWC.js";import{b as Q,e as U,g as w}from"./chunk-EQPD2MMQ.js";import{b as Wt,c as X}from"./chunk-YAXTLTJC.js";var zt=Wt((ct,Rt)=>{(function(o,i){typeof ct=="object"&&typeof Rt=="object"?Rt.exports=i():typeof define=="function"&&define.amd?define("IIIFMetadataComponent",[],i):typeof ct=="object"?ct.IIIFMetadataComponent=i():o.IIIFMetadataComponent=i()})(typeof self!="undefined"?self:ct,function(){return function(o){var i={};function a(u){if(i[u])return i[u].exports;var c=i[u]={i:u,l:!1,exports:{}};return o[u].call(c.exports,c,c.exports,a),c.l=!0,c.exports}return a.m=o,a.c=i,a.d=function(u,c,p){a.o(u,c)||Object.defineProperty(u,c,{enumerable:!0,get:p})},a.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},a.t=function(u,c){if(1&c&&(u=a(u)),8&c||4&c&&typeof u=="object"&&u&&u.__esModule)return u;var p=Object.create(null);if(a.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:u}),2&c&&typeof u!="string")for(var s in u)a.d(p,s,function(v){return u[v]}.bind(null,s));return p},a.n=function(u){var c=u&&u.__esModule?function(){return u.default}:function(){return u};return a.d(c,"a",c),c},a.o=function(u,c){return Object.prototype.hasOwnProperty.call(u,c)},a.p="",a(a.s=0)}([function(o,i,a){o.exports=a(1)},function(o,i,a){"use strict";var u,c=this&&this.__extends||(u=function(h,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}u(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(i,"__esModule",{value:!0});var p,s=a(2),v=a(3),f=a(4);(function(h){h.LINES="lines",h.CHARS="chars"})(p=i.LimitType||(i.LimitType={}));var l=function(h){function e(t){var n=h.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return c(e,h),e.prototype._init=function(){return h.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},e.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:p.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(t){return t},showAllLanguages:!1}},e.prototype._getManifestGroup=function(){return this._metadataGroups.filter(function(t){return t.resource.isManifest()})[0]},e.prototype._getCanvasGroups=function(){return this._metadataGroups.filter(function(t){return t.resource.isCanvas()})},e.prototype.set=function(t){var n=this;if(this._data=Object.assign(this._data,t),this._data&&this._data.helper){var r,d={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(d),this._data.manifestDisplayOrder&&((r=this._getManifestGroup()).items=this._sortItems(r.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach(function(S,y){S.items=n._sortItems(S.items,n._readCSV(n._data.canvasDisplayOrder))}),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((r=this._getManifestGroup()).items=this._exclude(r.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach(function(S,y){S.items=n._exclude(S.items,n._readCSV(n._data.canvasExclude))}),this._data.limitToRange){var b=[];this._metadataGroups.forEach(function(S,y){S.resource.isRange()&&b.push(S)}),b.length&&(this._metadataGroups=b)}this._render()}},e.prototype._sortItems=function(t,n){var r=this,d=[],b=t.slice(0);return n.forEach(function(S,y){var A=b.filter(function(x){return r._normalise(x.getLabel())===S})[0];if(A){d.push(A);var C=b.indexOf(A);C>-1&&b.splice(C,1)}}),b.forEach(function(S,y){d.push(S)}),d},e.prototype._sortGroups=function(t,n){var r=[],d=t.slice(0);return n.forEach(function(b,S){var y=d.filter(function(C){return C.resource.getIIIFResourceType().toLowerCase()==b.toLowerCase()})[0];if(y){r.push(y);var A=d.indexOf(y);A>-1&&d.splice(A,1)}}),r},e.prototype._label=function(t,n){t.forEach(function(r,d){r.label=n[d]})},e.prototype._exclude=function(t,n){var r=this;return n.forEach(function(d,b){var S=t.filter(function(A){return r._normalise(A.getLabel())===d})[0];if(S){var y=t.indexOf(S);y>-1&&t.splice(y,1)}}),t},e.prototype._normalise=function(t){return t?t.toLowerCase().replace(/ /g,""):null},e.prototype._render=function(){var t=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach(function(n,r){var d=t._buildMetadataGroup(n);t._$metadataGroups.append(d);var b=d.find(".value");t._data.limit&&t._data.content&&(t._data.limitType===p.LINES?b.toggleExpandTextByLines(t._data.limit,t._data.content.less,t._data.content.more,function(){}):t._data.limitType===p.CHARS&&b.ellipsisHtmlFixed(t._data.limit,function(){}))})):this._$noData.show()},e.prototype._buildMetadataGroup=function(t){var n=this._$metadataGroupTemplate.clone(),r=n.find(">.header");if(this._data.content){if(t.resource.isManifest()&&this._data.content.manifestHeader)(b=this._sanitize(this._data.content.manifestHeader))&&r.html(b);else if(t.resource.isSequence()&&this._data.content.sequenceHeader)(b=this._sanitize(this._data.content.sequenceHeader))&&r.html(b);else if(t.resource.isRange()&&this._data.content.rangeHeader)(b=this._sanitize(this._data.content.rangeHeader))&&r.html(b);else if(t.resource.isCanvas()&&(t.label||this._data.content.canvasHeader)){var d=t.label||this._data.content.canvasHeader;r.html(this._sanitize(d))}else if(t.resource.isAnnotation()&&this._data.content.imageHeader){var b;(b=this._sanitize(this._data.content.imageHeader))&&r.html(b)}}r.text()||r.hide();for(var S=n.find(".items"),y=0;y<t.items.length;y++){var A=t.items[y],C=this._buildMetadataItem(A);S.append(C)}return n},e.prototype._buildMetadataItem=function(t){var n,r=this._$metadataItemTemplate.clone(),d=r.find(".label"),b=r.find(".values"),S=t.getLabel(),y=S,A=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&y&&t.isRootLevel)switch(y.toLowerCase()){case"attribution":y=this._data.content.attribution;break;case"description":y=this._data.content.description;break;case"license":y=this._data.content.license;break;case"logo":y=this._data.content.logo}if(y=this._sanitize(y),d.html(y),this._addReadingDirection(d,this._getLabelLocale(t)),r.addClass(f.Strings.toCssClass(y)),S&&S.toLowerCase()==="license"&&A.exec(t.value[0].value)!==null)n=this._buildMetadataItemURIValue(t.value[0].value),b.append(n);else if(this._data.showAllLanguages&&t.value&&t.value.length>1)for(var C=0;C<t.value.length;C++){var x=t.value[C];n=this._buildMetadataItemValue(x.value,x.locale),b.append(n)}else{var I=this._getValueLocale(t),m=!1;for(C=0;C<t.value.length;C++){var x=t.value[C];I.toLowerCase()===x.locale.toLowerCase()&&(m=!0,n=this._buildMetadataItemValue(x.value,x.locale),b.append(n))}m||(x=t.value[0])&&(n=this._buildMetadataItemValue(x.value,x.locale),b.append(n))}this._data.copyToClipboardEnabled&&f.Clipboard.supportsCopy()&&d.text()&&this._addCopyButton(r,d,b);var _=this;return r.on("click","a.iiif-viewer-link",function(T){T.preventDefault();var O=$(T.target),L=O.attr("data-uv-navigate")||O.prop("href");_.fire(g.IIIF_VIEWER_LINK_CLICKED,L)}),r.on("click","[data-uv-navigate]",function(T){T.preventDefault();var O=$(T.target).attr("data-uv-navigate")||null;O&&_.fire(g.IIIF_VIEWER_LINK_CLICKED,O)}),r},e.prototype._getLabelLocale=function(t){if(!this._data||!this._data.helper)return"";var n=this._data.helper.options.locale;if(t.label.length){var r=t.label[0].locale;if(r.toLowerCase()!==n.toLowerCase())return r}return n},e.prototype._getValueLocale=function(t){return this._data&&this._data.helper?this._data.helper.options.locale:""},e.prototype._buildMetadataItemValue=function(t,n){t=(t=this._sanitize(t)).replace(`
`,"<br>");var r=this._$metadataItemValueTemplate.clone();return r.html(t),r.find("a").each(function(){var d=$(this);d.hasClass("iiif-viewer-link")||d.prop("target","_blank")}),n&&this._addReadingDirection(r,n),r},e.prototype._buildMetadataItemURIValue=function(t){t=this._sanitize(t);var n=this._$metadataItemURIValueTemplate.clone();return n.prop("href",t),n.text(t),n},e.prototype._addReadingDirection=function(t,n){n=s.Utils.getInexactLocale(n),this._readCSV(this._data.rtlLanguageCodes).filter(function(r){return r===n}).length>0&&(t.prop("dir","rtl"),t.addClass("rtl"))},e.prototype._addCopyButton=function(t,n,r){var d=this._$copyTextTemplate.clone(),b=d.children();n.append(d),f.Device.isTouch()?d.show():(t.on("mouseenter",function(){d.show()}),t.on("mouseleave",function(){d.hide()}),d.on("mouseleave",function(){b.hide()}));var S=this,y=r.text();d.on("click",function(A){S._copyItemValues(d,y)})},e.prototype._copyItemValues=function(t,n){f.Clipboard.copy(n);var r=t.find(".copiedText");r.show(),setTimeout(function(){r.hide()},this._data.copiedMessageDuration)},e.prototype._readCSV=function(t,n){n===void 0&&(n=!0);var r=[];if(t&&(r=t.split(","),n))for(var d=0;d<r.length;d++)r[d]=this._normalise(r[d]);return r},e.prototype._sanitize=function(t){return this._data.sanitizer?this._data.sanitizer(t):null},e.prototype._resize=function(){},e}(v.BaseComponent);i.MetadataComponent=l;var g=function(){function h(){}return h.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",h}();i.Events=g},function(o,i,a){o.exports=function(u){var c={};function p(s){if(c[s])return c[s].exports;var v=c[s]={i:s,l:!1,exports:{}};return u[s].call(v.exports,v,v.exports,p),v.l=!0,v.exports}return p.m=u,p.c=c,p.d=function(s,v,f){p.o(s,v)||Object.defineProperty(s,v,{enumerable:!0,get:f})},p.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},p.t=function(s,v){if(1&v&&(s=p(s)),8&v||4&v&&typeof s=="object"&&s&&s.__esModule)return s;var f=Object.create(null);if(p.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:s}),2&v&&typeof s!="string")for(var l in s)p.d(f,l,function(g){return s[g]}.bind(null,l));return f},p.n=function(s){var v=s&&s.__esModule?function(){return s.default}:function(){return s};return p.d(v,"a",v),v},p.o=function(s,v){return Object.prototype.hasOwnProperty.call(s,v)},p.p="",p(p.s=4)}([function(u,c,p){"use strict";function s(v){for(var f in v)c.hasOwnProperty(f)||(c[f]=v[f])}Object.defineProperty(c,"__esModule",{value:!0}),s(p(6)),s(p(7)),s(p(8)),s(p(9)),s(p(10)),s(p(11)),s(p(12)),s(p(13)),s(p(14)),s(p(15)),s(p(16)),s(p(17)),s(p(18)),s(p(19)),s(p(20)),s(p(21)),s(p(22)),s(p(23)),s(p(24)),s(p(25)),s(p(26)),s(p(27)),s(p(28)),s(p(29)),s(p(30)),s(p(31)),s(p(32)),s(p(2))},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(s){s.BOOKMARKING="oa:bookmarking",s.CLASSIFYING="oa:classifying",s.COMMENTING="oa:commenting",s.DESCRIBING="oa:describing",s.EDITING="oa:editing",s.HIGHLIGHTING="oa:highlighting",s.IDENTIFYING="oa:identifying",s.LINKING="oa:linking",s.MODERATING="oa:moderating",s.PAINTING="sc:painting",s.QUESTIONING="oa:questioning",s.REPLYING="oa:replying",s.TAGGING="oa:tagging",s.TRANSCRIBING="oad:transcribing"}(c.AnnotationMotivation||(c.AnnotationMotivation={})),function(s){s.AUTO_ADVANCE="auto-advance",s.CONTINUOUS="continuous",s.FACING_PAGES="facing-pages",s.HIDDEN="hidden",s.INDIVIDUALS="individuals",s.MULTI_PART="multi-part",s.NO_NAV="no-nav",s.NON_PAGED="non-paged",s.PAGED="paged",s.REPEAT="repeat",s.SEQUENCE="sequence",s.THUMBNAIL_NAV="thumbnail-nav",s.TOGETHER="together",s.UNORDERED="unordered"}(c.Behavior||(c.Behavior={})),function(s){s.CANVAS="canvas",s.CHOICE="choice",s.CONTENT_AS_TEXT="contentastext",s.DOCUMENT="document",s.IMAGE="image",s.MOVING_IMAGE="movingimage",s.PDF="pdf",s.PHYSICAL_OBJECT="physicalobject",s.SOUND="sound",s.TEXTUALBODY="textualbody",s.VIDEO="video"}(c.ExternalResourceType||(c.ExternalResourceType={})),function(s){s.ANNOTATION="annotation",s.CANVAS="canvas",s.COLLECTION="collection",s.MANIFEST="manifest",s.RANGE="range",s.SEQUENCE="sequence"}(c.IIIFResourceType||(c.IIIFResourceType={})),function(s){s.AUDIO_MP4="audio/mp4",s.CORTO="application/corto",s.DRACO="application/draco",s.GLTF="model/gltf+json",s.JPG="image/jpeg",s.M3U8="application/vnd.apple.mpegurl",s.MP3="audio/mp3",s.MPEG_DASH="application/dash+xml",s.OBJ="text/plain",s.PDF="application/pdf",s.PLY="application/ply",s.THREEJS="application/vnd.threejs+json",s.VIDEO_MP4="video/mp4",s.WEBM="video/webm"}(c.MediaType||(c.MediaType={})),function(s){s.DOC="application/msword",s.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",s.PDF="application/pdf"}(c.RenderingFormat||(c.RenderingFormat={})),function(s){s.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",s.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",s.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",s.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",s.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",s.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",s.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",s.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",s.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",s.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",s.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",s.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",s.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",s.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",s.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",s.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",s.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",s.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",s.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",s.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",s.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",s.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",s.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",s.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",s.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",s.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",s.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",s.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",s.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",s.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",s.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",s.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",s.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",s.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",s.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",s.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",s.SEARCH_0="http://iiif.io/api/search/0/search",s.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",s.SEARCH_1="http://iiif.io/api/search/1/search",s.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",s.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",s.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",s.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",s.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",s.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",s.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(c.ServiceProfile||(c.ServiceProfile={})),function(s){s.BOTTOM_TO_TOP="bottom-to-top",s.LEFT_TO_RIGHT="left-to-right",s.RIGHT_TO_LEFT="right-to-left",s.TOP_TO_BOTTOM="top-to-bottom"}(c.ViewingDirection||(c.ViewingDirection={})),function(s){s.CONTINUOUS="continuous",s.INDIVIDUALS="individuals",s.NON_PAGED="non-paged",s.PAGED="paged",s.TOP="top"}(c.ViewingHint||(c.ViewingHint={}))},function(u,c,p){"use strict";var s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(d,b){function S(C){try{A(r.next(C))}catch(x){b(x)}}function y(C){try{A(r.throw(C))}catch(x){b(x)}}function A(C){var x;C.done?d(C.value):(x=C.value,x instanceof n?x:new n(function(I){I(x)})).then(S,y)}A((r=r.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){var n,r,d,b,S={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return b={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function y(A){return function(C){return function(x){if(n)throw new TypeError("Generator is already executing.");for(;S;)try{if(n=1,r&&(d=2&x[0]?r.return:x[0]?r.throw||((d=r.return)&&d.call(r),0):r.next)&&!(d=d.call(r,x[1])).done)return d;switch(r=0,d&&(x=[2&x[0],d.value]),x[0]){case 0:case 1:d=x;break;case 4:return S.label++,{value:x[1],done:!1};case 5:S.label++,r=x[1],x=[0];continue;case 7:x=S.ops.pop(),S.trys.pop();continue;default:if(!(d=(d=S.trys).length>0&&d[d.length-1])&&(x[0]===6||x[0]===2)){S=0;continue}if(x[0]===3&&(!d||x[1]>d[0]&&x[1]<d[3])){S.label=x[1];break}if(x[0]===6&&S.label<d[1]){S.label=d[1],d=x;break}if(d&&S.label<d[2]){S.label=d[2],S.ops.push(x);break}d[2]&&S.ops.pop(),S.trys.pop();continue}x=t.call(e,S)}catch(I){x=[6,I],r=0}finally{n=d=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([A,C])}}};Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=p(1),g=p(33);p(34);var h=function(){function e(){}return e.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(t){return t===l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_LEVEL_1||t===l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_LEVEL_2||t===l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(t){return t.indexOf("-")!==-1?t.substr(0,t.indexOf("-")):t},e.getLocalisedValue=function(t,n){if(!Array.isArray(t))return t;for(var r=0;r<t.length;r++){var d=t[r];if(n===d["@language"])return d["@value"]}var b=n.substr(0,n.indexOf("-"));for(r=0;r<t.length;r++){var S=t[r];if(S["@language"]===b)return S["@value"]}return null},e.generateTreeNodeIds=function(t,n){var r;n===void 0&&(n=0),r=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=r;for(var d=0;d<t.nodes.length;d++){var b=t.nodes[d];e.generateTreeNodeIds(b,d)}},e.normaliseType=function(t){return(t=t.toLowerCase()).indexOf(":")!==-1?t.split(":")[1]:t},e.normaliseUrl=function(t){return(t=t.substr(t.indexOf("://"))).indexOf("#")!==-1&&(t=t.split("#")[0]),t},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(t,n){return f.Deserialiser.parse(t,n)},e.checkStatus=function(t){if(t.ok)return t;var n=new Error(t.statusText);return n.response=t,Promise.reject(n)},e.loadManifest=function(t){return new Promise(function(n){fetch(t).then(e.checkStatus).then(function(r){return r.json()}).then(function(r){n(r)})})},e.loadExternalResourcesAuth1=function(t,n,r,d,b,S,y,A){return new Promise(function(C,x){var I=t.map(function(m){return e.loadExternalResourceAuth1(m,n,r,d,b,S,y,A)});Promise.all(I).then(function(){C(t)}).catch(function(m){x(m)})})},e.loadExternalResourceAuth1=function(t,n,r,d,b,S,y,A){return s(this,void 0,void 0,function(){var C;return v(this,function(x){switch(x.label){case 0:return[4,d(t)];case 1:return(C=x.sent())?[4,t.getData(C)]:[3,6];case 2:return x.sent(),t.status!==g.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,r,b,S,y,A)];case 4:x.sent(),x.label=5;case 5:if(t.status===g.OK||t.status===g.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return x.sent(),t.status!==g.MOVED_TEMPORARILY&&t.status!==g.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,r,b,S,y,A)];case 8:x.sent(),x.label=9;case 9:if(t.status===g.OK||t.status===g.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,r,d,b,S,y){return s(this,void 0,void 0,function(){var A,C,x,I,m,_,T,O;return v(this,function(L){switch(L.label){case 0:return t.isAccessControlled()?((A=t.externalService)&&(A.options=t.options),(C=t.kioskService)&&(C.options=t.options),(x=t.clickThroughService)&&(x.options=t.options),(I=t.loginService)&&(I.options=t.options),t.isResponseHandled||t.status!==g.MOVED_TEMPORARILY?[3,2]:[4,S(t)]):[2,t];case 1:return L.sent(),[2,t];case 2:return m=null,_=null,(m=A)?(_=m,[4,e.attemptResourceWithToken(t,r,m)]):[3,4];case 3:return L.sent(),[2,t];case 4:return(m=C)?(_=m,(T=n(m))?[4,d(T)]:[3,7]):[3,7];case 5:return L.sent(),[4,e.attemptResourceWithToken(t,r,m)];case 6:return L.sent(),[2,t];case 7:return(m=x)?(_=m,[4,b(t,m)]):[3,11];case 8:return(O=L.sent())?[4,d(O)]:[3,11];case 9:return L.sent(),[4,e.attemptResourceWithToken(t,r,m)];case 10:return L.sent(),[2,t];case 11:return(m=I)?(_=m,[4,b(t,m)]):[3,15];case 12:return(O=L.sent())?[4,d(O)]:[3,15];case 13:return L.sent(),[4,e.attemptResourceWithToken(t,r,m)];case 14:return L.sent(),[2,t];case 15:return _&&y(t,_),[2]}})})},e.attemptResourceWithToken=function(t,n,r){return s(this,void 0,void 0,function(){var d,b;return v(this,function(S){switch(S.label){case 0:return(d=r.getService(l.ServiceProfile.AUTH_1_TOKEN))?[4,n(t,d)]:[3,3];case 1:return(b=S.sent())&&b.accessToken?[4,t.getData(b)]:[3,3];case 2:return S.sent(),[2,t];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,r,d,b,S,y,A,C,x){return new Promise(function(I,m){var _=t.map(function(T){return e.loadExternalResourceAuth09(T,n,r,d,b,S,y,A,C,x)});Promise.all(_).then(function(){I(t)}).catch(function(T){m(T)})})},e.loadExternalResourceAuth09=function(t,n,r,d,b,S,y,A,C,x){return new Promise(function(I,m){x&&x.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(I(r(t)),I(d(t))):b(t).then(function(){S(t,!0).then(function(_){t.getData(_).then(function(){I(C(t))}).catch(function(T){m(e.createInternalServerError(T))})}).catch(function(_){m(e.createInternalServerError(_))})}).catch(function(_){m(e.createInternalServerError(_))}):I(t)}).catch(function(_){m(e.createInternalServerError(_))}):A(t,n).then(function(_){_?t.getData(_).then(function(){t.status===g.OK?I(C(t)):e.authorize(t,n,r,d,b,S,y,A).then(function(){I(C(t))}).catch(function(T){m(e.createAuthorizationFailedError())})}).catch(function(T){m(e.createAuthorizationFailedError())}):e.authorize(t,n,r,d,b,S,y,A).then(function(){I(C(t))}).catch(function(T){m(e.createAuthorizationFailedError())})}).catch(function(_){m(e.createAuthorizationFailedError())})})},e.createError=function(t,n){var r=new Error;return r.message=n,r.name=String(t),r},e.createAuthorizationFailedError=function(){return e.createError(f.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(f.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(f.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,r,d,b,S,y,A){return new Promise(function(C,x){t.getData().then(function(){t.isAccessControlled()?A(t,n).then(function(I){I?t.getData(I).then(function(){t.status===g.OK?C(t):e.showAuthInteraction(t,n,r,d,b,S,y,C,x)}).catch(function(m){x(e.createInternalServerError(m))}):S(t,!1).then(function(m){m?y(t,m,n).then(function(){t.getData(m).then(function(){t.status===g.OK?C(t):e.showAuthInteraction(t,n,r,d,b,S,y,C,x)}).catch(function(_){x(e.createInternalServerError(_))})}).catch(function(_){x(e.createInternalServerError(_))}):e.showAuthInteraction(t,n,r,d,b,S,y,C,x)})}).catch(function(I){x(e.createInternalServerError(I))}):C(t)})})},e.showAuthInteraction=function(t,n,r,d,b,S,y,A,C){t.status!==g.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?r(t).then(function(){S(t,!0).then(function(x){y(t,x,n).then(function(){t.getData(x).then(function(){A(t)}).catch(function(I){C(e.createInternalServerError(I))})}).catch(function(I){C(e.createInternalServerError(I))})}).catch(function(x){C(e.createInternalServerError(x))})}):b(t).then(function(){S(t,!0).then(function(x){y(t,x,n).then(function(){t.getData(x).then(function(){A(t)}).catch(function(I){C(e.createInternalServerError(I))})}).catch(function(I){C(e.createInternalServerError(I))})}).catch(function(x){C(e.createInternalServerError(x))})}):A(t)},e.getService=function(t,n){for(var r=this.getServices(t),d=0;d<r.length;d++){var b=r[d];if(b.getProfile()===n)return b}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,r){if(t.hasOwnProperty(n)&&t[n]===r)return t;for(var d=0;d<Object.keys(t).length;d++)if(typeof t[Object.keys(t)[d]]=="object"){var b=e.traverseAndFind(t[Object.keys(t)[d]],n,r);if(b!=null)return b}},e.getServices=function(t){var n,r=[];if(!(n=t.__jsonld?t.__jsonld.service:t.service))return r;Array.isArray(n)||(n=[n]);for(var d=0;d<n.length;d++){var b=n[d];if(typeof b=="string"){var S=this.getResourceById(t.options.resource,b);S&&r.push(new f.Service(S.__jsonld||S,t.options))}else r.push(new f.Service(b,t.options))}return r},e.getTemporalComponent=function(t){var n=/t=([^&]+)/g.exec(t),r=null;return n&&n[1]&&(r=n[1].split(",")),r},e}();c.Utils=h},function(u,c,p){"use strict";p.r(c),c.default=function(s,v){return v=v||{},new Promise(function(f,l){var g=new XMLHttpRequest,h=[],e=[],t={},n=function(){return{ok:(g.status/100|0)==2,statusText:g.statusText,status:g.status,url:g.responseURL,text:function(){return Promise.resolve(g.responseText)},json:function(){return Promise.resolve(JSON.parse(g.responseText))},blob:function(){return Promise.resolve(new Blob([g.response]))},clone:n,headers:{keys:function(){return h},entries:function(){return e},get:function(d){return t[d.toLowerCase()]},has:function(d){return d.toLowerCase()in t}}}};for(var r in g.open(v.method||"get",s,!0),g.onload=function(){g.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(d,b,S){h.push(b=b.toLowerCase()),e.push([b,S]),t[b]=t[b]?t[b]+","+S:S}),f(n())},g.onerror=l,g.withCredentials=v.credentials=="include",v.headers)g.setRequestHeader(r,v.headers[r]);g.send(v.body||null)})}},function(u,c,p){u.exports=p(5)},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(v){for(var f in v)c.hasOwnProperty(f)||(c[f]=v[f])}(p(0));var s=p(2);c.loadManifest=function(v){return s.Utils.loadManifest(v)},c.parseManifest=function(v,f){return s.Utils.parseManifest(v,f)}},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=function(){function v(f){this.__jsonld=f,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return v.prototype.getProperty=function(f){var l=null;return this.__jsonld&&((l=this.__jsonld[f])||(l=this.__jsonld["@"+f])),l},v}();c.JSONLDResource=s},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=p(1),g=function(h){function e(t,n){var r=h.call(this,t)||this;return r.options=n,r}return v(e,h),e.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?f.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDefaultLabel=function(){return f.LanguageMap.getValue(this.getLabel())},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),n=[];if(!t)return n;for(var r=0;r<t.length;r++){var d=t[r],b=new f.LabelValuePair(this.options.locale);b.parse(d),n.push(b)}return n},e.prototype.getRendering=function(t){for(var n=this.getRenderings(),r=0;r<n.length;r++){var d=n[r];if(d.getFormat()===t)return d}return null},e.prototype.getRenderings=function(){var t,n=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var d=t[r];n.push(new f.Rendering(d,this.options))}return n},e.prototype.getService=function(t){return f.Utils.getService(this,t)},e.prototype.getServices=function(){return f.Utils.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new f.Thumbnail(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===l.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===l.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===l.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===l.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===l.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===l.IIIFResourceType.SEQUENCE},e}(f.JSONLDResource);c.ManifestResource=g},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t){return g.call(this,e,t)||this}return v(h,g),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},h.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],r=new f.Annotation(n,this.options);e.push(r)}return e},h.prototype.getType=function(){var e=this.getProperty("type");return e?f.Utils.normaliseType(e):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},h.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},h}(f.ManifestResource);c.Resource=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=p(1),g=function(h){function e(t,n){var r=h.call(this,t,n)||this;r.index=-1,r.isLoaded=!1;var d={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(d,n),r}return v(e,h),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?f.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?f.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?typeof t=="string"?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return f.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(l.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new f.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,n=this.getProperty("requiredStatement");if(n)(t=new f.LabelValuePair(this.options.locale)).parse(n);else{var r=this.getAttribution();r&&((t=new f.LabelValuePair(this.options.locale)).value=r)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===l.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===l.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise(function(n){if(t.isLoaded)n(t);else{var r=t.options;r.navDate=t.getNavDate();var d=t.__jsonld.id;d||(d=t.__jsonld["@id"]),f.Utils.loadManifest(d).then(function(b){t.parentLabel=f.LanguageMap.getValue(t.getLabel(),r.locale);var S=f.Deserialiser.parse(b,r);(t=Object.assign(t,S)).index=r.index,n(t)})}})},e}(f.ManifestResource);c.IIIFResource=g},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t){return g.call(this,e,t)||this}return v(h,g),h.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((b=t[n]).items)for(var r=0;r<b.items.length;r++){var d=b.items[r];e.push(new f.AnnotationBody(d,this.options))}else e.push(new f.AnnotationBody(b,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var b=t.items[n];e.push(new f.AnnotationBody(b,this.options))}else e.push(new f.AnnotationBody(t,this.options));return e},h.prototype.getMotivation=function(){return this.getProperty("motivation")||null},h.prototype.getOn=function(){return this.getProperty("on")},h.prototype.getTarget=function(){return this.getProperty("target")},h.prototype.getResource=function(){return new f.Resource(this.getProperty("resource"),this.options)},h}(f.ManifestResource);c.Annotation=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t){return g.call(this,e,t)||this}return v(h,g),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?f.Utils.getMediaType(e):null},h.prototype.getType=function(){return this.getProperty("type")?f.Utils.normaliseType(this.getProperty("type")):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(f.ManifestResource);c.AnnotationBody=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t,n){var r=g.call(this,t)||this;return r.label=e,r.options=n,r}return v(h,g),h.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},h.prototype.getLabel=function(){return this.label},h.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new f.Annotation(t,e.options)})},h.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var r=e.__jsonld.id;r||(r=e.__jsonld["@id"]),f.Utils.loadManifest(r).then(function(d){e.__jsonld=d,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)}).catch(n)}})},h}(f.JSONLDResource);c.AnnotationList=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(l,g){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,g)},function(l,g){function h(){this.constructor=l}s(l,g),l.prototype=g===null?Object.create(g):(h.prototype=g.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var f=function(l){function g(h,e){return l.call(this,h,e)||this}return v(g,l),g.prototype.getItems=function(){return this.getProperty("items")},g}(p(0).ManifestResource);c.AnnotationPage=f},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t){return g.call(this,e,t)||this}return v(h,g),h.prototype.getCanonicalImageUri=function(e){var t,n=null,r="default",d=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],d||(d=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var b=this.getImages();if(b&&b.length){var S=b[0].getResource(),y=S.getServices();if(d||(d=S.getWidth()),y.length){var A=y[0];n=A.id,r=f.Utils.getImageQuality(A.getProfile())}else if(d===S.getWidth())return S.id}if(!n){var C=this.getProperty("thumbnail");if(C){if(typeof C=="string")return C;if(C["@id"])return C["@id"];if(C.length)return C[0].id}}}return t=d+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,r+".jpg"].join("/")},h.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(n){return n.maxWidth})[0])&&(t=new f.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},h.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new f.AnnotationPage(t[0],this.options)),!n)return e;for(var r=n.getItems(),d=0;d<r.length;d++){var b=r[d],S=new f.Annotation(b,this.options);e.push(S)}return e},h.prototype.getDuration=function(){return this.getProperty("duration")},h.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],r=new f.Annotation(n,this.options);e.push(r)}return e},h.prototype.getIndex=function(){return this.getProperty("index")},h.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(r=n["@type"])=="string"&&r.toLowerCase()==r.toLowerCase();var r}).map(function(n,r){return new f.AnnotationList(n.label||"Annotation list "+r,n,e.options)}).map(function(n){return n.load()});return Promise.all(t)},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(f.Resource);c.Canvas=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(1),l=p(0),g=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._collections=null,r._manifests=null,t.__collection=r,r}return v(e,h),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(t){return t.isCollection()})},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(t){return t.isManifest()})},e.prototype.getCollectionByIndex=function(t){for(var n,r=this.getCollections(),d=0;d<r.length;d++){var b=r[d];b.index===t&&(n=b)}if(n)return n.options.index=t,n.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var n,r=this.getManifests(),d=0;d<r.length;d++){var b=r[d];b.index===t&&(n=b)}if(n)return n.options.index=t,n.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):f.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getDefaultTree=function(){return h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=l.Utils.normaliseType(l.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),l.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var n=0;n<t.getManifests().length;n++){var r=t.getManifests()[n],d=r.getDefaultTree();d.label=r.parentLabel||l.LanguageMap.getValue(r.getLabel(),this.options.locale)||"manifest "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=l.Utils.normaliseType(l.TreeNodeType.MANIFEST),t.defaultTree.addNode(d)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var n=0;n<t.getCollections().length;n++){var r=t.getCollections()[n],d=r.getDefaultTree();d.label=r.parentLabel||l.LanguageMap.getValue(r.getLabel(),this.options.locale)||"collection "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=l.Utils.normaliseType(l.TreeNodeType.COLLECTION),t.defaultTree.addNode(d)}},e}(l.IIIFResource);c.Collection=g},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=function(){function v(f,l){this.start=f,this.end=l}return v.prototype.getLength=function(){return this.end-this.start},v}();c.Duration=s},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=p(0),v=function(){function f(l){this.defaultLocale=l}return f.prototype.parse=function(l){this.resource=l,this.label=s.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=s.LanguageMap.parse(this.resource.value,this.defaultLocale)},f.prototype.getLabel=function(){return this.label?s.LanguageMap.getValue(this.label,this.defaultLocale):null},f.prototype.setLabel=function(l){var g=this;if(this.label&&this.label.length){var h=this.label.filter(function(e){return e.locale===g.defaultLocale||e.locale===s.Utils.getInexactLocale(g.defaultLocale)})[0];h&&(h.value=l)}},f.prototype.getValue=function(){if(this.value){var l=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(l=this.label[0].locale),s.LanguageMap.getValue(this.value,l)}return null},f.prototype.setValue=function(l){var g=this;if(this.value&&this.value.length){var h=this.value.filter(function(e){return e.locale===g.defaultLocale||e.locale===s.Utils.getInexactLocale(g.defaultLocale)})[0];h&&(h.value=l)}},f}();c.LabelValuePair=v},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Language=function(s,v){Array.isArray(s)?s.length===1?this.value=s[0]:this.value=s.join("<br/>"):this.value=s,this.locale=v}},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(){return g!==null&&g.apply(this,arguments)||this}return v(h,g),h.parse=function(e,t){var n,r=[];if(!e)return r;if(Array.isArray(e))for(var d=0;d<e.length;d++){var b=e[d];n=typeof b=="string"?new f.Language(b,t):new f.Language(b["@value"],b["@language"]||t),r.push(n)}else{if(typeof e=="string")return n=new f.Language(e,t),r.push(n),r;e["@value"]?(n=new f.Language(e["@value"],e["@language"]||t),r.push(n)):Object.keys(e).forEach(function(S){if(!e[S].length)throw new Error("language must have a value");n=new f.Language(e[S],S),r.push(n)})}return r},h.getValue=function(e,t){if(e.length){if(t){var n=e.filter(function(r){return r.locale===t||f.Utils.getInexactLocale(r.locale)===f.Utils.getInexactLocale(t)})[0];if(n)return n.value}return e[0].value}return null},h}(Array);c.LanguageMap=l},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(1),l=p(0),g=function(h){function e(t,n){var r=h.call(this,t,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var d=r._getTopRanges(),b=0;b<d.length;b++){var S=d[b];r._parseRanges(S,String(b))}return r}return v(e,h),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new l.Canvas(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=l.Utils.normaliseType(l.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),l.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];r.viewingHint===f.ViewingHint.TOP&&t.push(r)}if(!t.length){var d={};d.ranges=this.__jsonld.structures,t.push(d)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];if(r["@id"]===t||r.id===t)return r}return null},e.prototype._parseRanges=function(t,n,r){var d,b=null;if(typeof t=="string"&&(b=t,t=this._getRangeById(b)),t){(d=new l.Range(t,this.options)).parentRange=r,d.path=n,r?r.items.push(d):this._topRanges.push(d);var S=t.items||t.members;if(S)for(var y=0;y<S.length;y++){var A=S[y];if(A["@type"]&&A["@type"].toLowerCase()==="sc:range"||A.type&&A.type.toLowerCase()==="range")this._parseRanges(A,n+"/"+y,d);else if(A["@type"]&&A["@type"].toLowerCase()==="sc:canvas"||A.type&&A.type.toLowerCase()==="canvas"){d.canvases||(d.canvases=[]);var C=A.id||A["@id"];d.canvases.push(C)}}else if(t.ranges)for(y=0;y<t.ranges.length;y++)this._parseRanges(t.ranges[y],n+"/"+y,d)}else console.warn("Range:",b,"does not exist")},e.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),n=function(b){var S=t[b];S.id&&r._allRanges.push(S);var y=function(C,x){C.add(x);var I=x.getRanges();return I.length?I.reduce(y,C):C},A=Array.from(S.getRanges().reduce(y,new Set));r._allRanges=r._allRanges.concat(A)},r=this,d=0;d<t.length;d++)n(d);return this._allRanges},e.prototype.getRangeById=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.id===t)return d}return null},e.prototype.getRangeByPath=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.path===t)return d}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var n=0;n<t.length;n++){var r=t[n],d=new l.Sequence(r,this.options);this.items.push(d)}else this.__jsonld.items&&(d=new l.Sequence(this.__jsonld.items,this.options),this.items.push(d));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(f.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):l.ManifestType.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===f.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===f.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(l.IIIFResource);c.Manifest=g},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(s){s.EMPTY="",s.MANUSCRIPT="manuscript",s.MONOGRAPH="monograph"}(c.ManifestType||(c.ManifestType={}))},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=p(1),g=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return v(e,h),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){var t,n;if(this.canvases&&this.canvases.length)for(var r=0;r<this.canvases.length;r++){var d=this.canvases[r],b=f.Utils.getTemporalComponent(d);b&&b.length>1&&(r===0&&(t=Number(b[0])),r===this.canvases.length-1&&(n=Number(b[1])))}else{var S=this.getRanges();for(r=0;r<S.length;r++){var y=S[r].getDuration();y&&(r===0&&(t=y.start),r===S.length-1&&(n=y.end))}}if(t!==void 0&&n!==void 0)return new f.Duration(t,n)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(t){return t.isRange()})},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var n=this.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var d=n[r],b=new f.TreeNode;t.addNode(b),this._parseTreeNode(b,d)}return f.Utils.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var n=this.getDuration();return!!(n&&t>=n.start&&t<=n.end)},e.prototype._parseTreeNode=function(t,n){t.label=f.LanguageMap.getValue(n.getLabel(),this.options.locale),t.data=n,t.data.type=f.Utils.normaliseType(f.TreeNodeType.RANGE),n.treeNode=t;var r=n.getRanges();if(r&&r.length)for(var d=0;d<r.length;d++){var b=r[d];if(b.getBehavior()!==l.Behavior.NO_NAV){var S=new f.TreeNode;t.addNode(S),this._parseTreeNode(S,b)}}},e}(f.ManifestResource);c.Range=g},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(l,g){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,g)},function(l,g){function h(){this.constructor=l}s(l,g),l.prototype=g===null?Object.create(g):(h.prototype=g.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var f=function(l){function g(h,e){return l.call(this,h,e)||this}return v(g,l),g.prototype.getFormat=function(){return this.getProperty("format")},g}(p(0).ManifestResource);c.Rendering=f},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(h,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}s(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(1),l=p(0),g=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._thumbnails=null,r}return v(e,h),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var n=0;n<t.length;n++){var r=t[n];(d=new l.Canvas(r,this.options)).index=n,this.items.push(d)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var d;r=this.__jsonld[n],(d=new l.Canvas(r,this.options)).index=n,this.items.push(d)}return this.items},e.prototype.getCanvasById=function(t){for(var n=0;n<this.getTotalCanvases();n++){var r=this.getCanvasByIndex(n),d=l.Utils.normaliseUrl(r.id);if(l.Utils.normaliseUrl(t)===d)return r}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n;return null},e.prototype.getCanvasIndexByLabel=function(t,n){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),n&&(t+="r"));for(var r,d,b,S=/(\d*)\D+(\d*)/,y=0;y<this.getTotalCanvases();y++){var A=this.getCanvasByIndex(y);if(l.LanguageMap.getValue(A.getLabel(),this.options.locale)===t||(r=S.exec(t))&&(d=r[1],(b=r[2])&&new RegExp("^"+d+"\\D+"+b+"$").test(A.getLabel().toString())))return y}return-1},e.prototype.getLastCanvasLabel=function(t){for(var n=this.getTotalCanvases()-1;n>=0;n--){var r=this.getCanvasByIndex(n),d=l.LanguageMap.getValue(r.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(d))return d}else if(d)return d}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),b=this.getViewingDirection();r=b&&b===f.ViewingDirection.RIGHT_TO_LEFT?d[0]+1:d[d.length-1]+1}else r=t+1;return r>this.getLastPageIndex()?-1:r},e.prototype.getPagedIndices=function(t,n){var r=[];if(n){r=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var d=this.getViewingDirection();d&&d===f.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(t);return r},e.prototype.getPrevPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),b=this.getViewingDirection();r=b&&b===f.ViewingDirection.RIGHT_TO_LEFT?d[d.length-1]-1:d[0]-1}else r=t-1;return r},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n}return 0},e.prototype.getThumbs=function(t,n){for(var r=[],d=this.getTotalCanvases(),b=0;b<d;b++){var S=this.getCanvasByIndex(b),y=new l.Thumb(t,S);r.push(y)}return r},e.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),n=0;n<t.length;n++){var r=t[n].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return t===0},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===f.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(l.ManifestResource);c.Sequence=g},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=p(0),v=function(){function f(){}return f.parse=function(l,g){return typeof l=="string"&&(l=JSON.parse(l)),this.parseJson(l,g)},f.parseJson=function(l,g){var h;if(g&&g.navDate&&!isNaN(g.navDate.getTime())&&(l.navDate=g.navDate.toString()),l["@type"])switch(l["@type"]){case"sc:Collection":h=this.parseCollection(l,g);break;case"sc:Manifest":h=this.parseManifest(l,g);break;default:return null}else switch(l.type){case"Collection":h=this.parseCollection(l,g);break;case"Manifest":h=this.parseManifest(l,g);break;default:return null}return h.isLoaded=!0,h},f.parseCollection=function(l,g){var h=new s.Collection(l,g);return g?(h.index=g.index||0,g.resource&&(h.parentCollection=g.resource.parentCollection)):h.index=0,this.parseCollections(h,g),this.parseManifests(h,g),this.parseItems(h,g),h},f.parseCollections=function(l,g){var h;if(l.__jsonld.collections?h=l.__jsonld.collections:l.__jsonld.items&&(h=l.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),h)for(var e=0;e<h.length;e++){g&&(g.index=e);var t=this.parseCollection(h[e],g);t.index=e,t.parentCollection=l,l.items.push(t)}},f.parseManifest=function(l,g){return new s.Manifest(l,g)},f.parseManifests=function(l,g){var h;if(l.__jsonld.manifests?h=l.__jsonld.manifests:l.__jsonld.items&&(h=l.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),h)for(var e=0;e<h.length;e++){var t=this.parseManifest(h[e],g);t.index=e,t.parentCollection=l,l.items.push(t)}},f.parseItem=function(l,g){if(l["@type"]){if(l["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(l,g);if(l["@type"].toLowerCase()==="sc:collection")return this.parseCollection(l,g)}else if(l.type){if(l.type.toLowerCase()==="manifest")return this.parseManifest(l,g);if(l.type.toLowerCase()==="collection")return this.parseCollection(l,g)}return null},f.parseItems=function(l,g){var h=l.__jsonld.members||l.__jsonld.items;if(h)for(var e=function(d){g&&(g.index=d);var b=t.parseItem(h[d],g);return b?l.items.filter(function(S){return S.id===b.id})[0]?"continue":(b.index=d,b.parentCollection=l,void l.items.push(b)):{value:void 0}},t=this,n=0;n<h.length;n++){var r=e(n);if(typeof r=="object")return r.value}},f}();c.Deserialiser=v},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(g,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(g,h)},function(g,h){function e(){this.constructor=g}s(g,h),g.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var f=p(0),l=function(g){function h(e,t){return g.call(this,e,t)||this}return v(h,g),h.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},h.prototype.getConfirmLabel=function(){return f.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},h.prototype.getDescription=function(){return f.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},h.prototype.getFailureDescription=function(){return f.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},h.prototype.getFailureHeader=function(){return f.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},h.prototype.getHeader=function(){return f.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},h.prototype.getServiceLabel=function(){return f.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},h.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},h}(f.ManifestResource);c.Service=l},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Size=function(s,v){this.width=s,this.height=v}},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(s){s[s.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",s[s.FORBIDDEN=2]="FORBIDDEN",s[s.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",s[s.RESTRICTED=4]="RESTRICTED"}(c.StatusCode||(c.StatusCode={}))},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=p(0);c.Thumb=function(v,f){this.data=f,this.index=f.index,this.width=v;var l=f.getHeight()/f.getWidth();this.height=l?Math.floor(this.width*l):v,this.uri=f.getCanonicalImageUri(v),this.label=s.LanguageMap.getValue(f.getLabel())}},function(u,c,p){"use strict";var s,v=this&&this.__extends||(s=function(l,g){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,g)},function(l,g){function h(){this.constructor=l}s(l,g),l.prototype=g===null?Object.create(g):(h.prototype=g.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var f=function(l){function g(h,e){return l.call(this,h,e)||this}return v(g,l),g}(p(0).Resource);c.Thumbnail=f},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var s=p(0),v=function(){function f(l,g){this.label=l,this.data=g||{},this.nodes=[]}return f.prototype.addNode=function(l){this.nodes.push(l),l.parentNode=this},f.prototype.isCollection=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.COLLECTION)},f.prototype.isManifest=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.MANIFEST)},f.prototype.isRange=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.RANGE)},f}();c.TreeNode=v},function(u,c,p){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(s){s.COLLECTION="collection",s.MANIFEST="manifest",s.RANGE="range"}(c.TreeNodeType||(c.TreeNodeType={}))},function(u,c,p){u.exports=function(s){var v={};function f(l){if(v[l])return v[l].exports;var g=v[l]={i:l,l:!1,exports:{}};return s[l].call(g.exports,g,g.exports,f),g.l=!0,g.exports}return f.m=s,f.c=v,f.d=function(l,g,h){f.o(l,g)||Object.defineProperty(l,g,{enumerable:!0,get:h})},f.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},f.t=function(l,g){if(1&g&&(l=f(l)),8&g||4&g&&typeof l=="object"&&l&&l.__esModule)return l;var h=Object.create(null);if(f.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:l}),2&g&&typeof l!="string")for(var e in l)f.d(h,e,function(t){return l[t]}.bind(null,e));return h},f.n=function(l){var g=l&&l.__esModule?function(){return l.default}:function(){return l};return f.d(g,"a",g),g},f.o=function(l,g){return Object.prototype.hasOwnProperty.call(l,g)},f.p="",f(f.s=0)}([function(s,v,f){s.exports=f(1)},function(s,v,f){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.CONTINUE=100,v.SWITCHING_PROTOCOLS=101,v.PROCESSING=102,v.OK=200,v.CREATED=201,v.ACCEPTED=202,v.NON_AUTHORITATIVE_INFORMATION=203,v.NO_CONTENT=204,v.RESET_CONTENT=205,v.PARTIAL_CONTENT=206,v.MULTI_STATUS=207,v.MULTIPLE_CHOICES=300,v.MOVED_PERMANENTLY=301,v.MOVED_TEMPORARILY=302,v.SEE_OTHER=303,v.NOT_MODIFIED=304,v.USE_PROXY=305,v.TEMPORARY_REDIRECT=307,v.BAD_REQUEST=400,v.UNAUTHORIZED=401,v.PAYMENT_REQUIRED=402,v.FORBIDDEN=403,v.NOT_FOUND=404,v.METHOD_NOT_ALLOWED=405,v.NOT_ACCEPTABLE=406,v.PROXY_AUTHENTICATION_REQUIRED=407,v.REQUEST_TIME_OUT=408,v.CONFLICT=409,v.GONE=410,v.LENGTH_REQUIRED=411,v.PRECONDITION_FAILED=412,v.REQUEST_ENTITY_TOO_LARGE=413,v.REQUEST_URI_TOO_LARGE=414,v.UNSUPPORTED_MEDIA_TYPE=415,v.REQUESTED_RANGE_NOT_SATISFIABLE=416,v.EXPECTATION_FAILED=417,v.IM_A_TEAPOT=418,v.UNPROCESSABLE_ENTITY=422,v.LOCKED=423,v.FAILED_DEPENDENCY=424,v.UNORDERED_COLLECTION=425,v.UPGRADE_REQUIRED=426,v.PRECONDITION_REQUIRED=428,v.TOO_MANY_REQUESTS=429,v.REQUEST_HEADER_FIELDS_TOO_LARGE=431,v.INTERNAL_SERVER_ERROR=500,v.NOT_IMPLEMENTED=501,v.BAD_GATEWAY=502,v.SERVICE_UNAVAILABLE=503,v.GATEWAY_TIME_OUT=504,v.HTTP_VERSION_NOT_SUPPORTED=505,v.VARIANT_ALSO_NEGOTIATES=506,v.INSUFFICIENT_STORAGE=507,v.BANDWIDTH_LIMIT_EXCEEDED=509,v.NOT_EXTENDED=510,v.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(u,c,p){u.exports=window.fetch||(window.fetch=p(3).default||p(3))}])},function(o,i,a){"use strict";a.r(i),a.d(i,"BaseComponent",function(){return u});var u=function(){function c(p){this.options=p,this.options.data=Object.assign({},this.data(),p.data)}return c.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},c.prototype.data=function(){return{}},c.prototype.on=function(p,s,v){var f=this._e||(this._e={});(f[p]||(f[p]=[])).push({fn:s,ctx:v})},c.prototype.fire=function(p){for(var s=[],v=1;v<arguments.length;v++)s[v-1]=arguments[v];for(var f=[].slice.call(arguments,1),l=((this._e||(this._e={}))[p]||[]).slice(),g=0,h=l.length;g<h;g++)l[g].fn.apply(l[g].ctx,f)},c.prototype._resize=function(){},c.prototype.set=function(p){},c}()},function(o,i,a){"use strict";a.r(i),a.d(i,"Async",function(){return c}),a.d(i,"Bools",function(){return p}),a.d(i,"Clipboard",function(){return s}),a.d(i,"Colors",function(){return v}),a.d(i,"Dates",function(){return f}),a.d(i,"Device",function(){return l}),a.d(i,"Documents",function(){return g}),a.d(i,"Events",function(){return h}),a.d(i,"Files",function(){return e}),a.d(i,"Keyboard",function(){return t}),a.d(i,"Maths",function(){return n}),a.d(i,"Size",function(){return r}),a.d(i,"Dimensions",function(){return d}),a.d(i,"Numbers",function(){return b}),a.d(i,"Objects",function(){return S}),a.d(i,"Storage",function(){return y}),a.d(i,"StorageItem",function(){return A}),a.d(i,"StorageType",function(){return u}),a.d(i,"Strings",function(){return C}),a.d(i,"Urls",function(){return x});var u,c=function(){function I(){}return I.waitFor=function(m,_,T,O,L,P){O||(O=200),L||(L=100),P||(P=0),(P+=1)>L?T&&T():m()?_():setTimeout(function(){I.waitFor(m,_,T,O,L,P)},O)},I}(),p=function(){function I(){}return I.getBool=function(m,_){return m??_},I}(),s=function(){function I(){}return I.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},I.copy=function(m){m=I.convertBrToNewLine(m);var _=document.createElement("textarea");_.value=m,I.hideButKeepEnabled(_),document.body.appendChild(_),_.focus(),_.select(),document.execCommand("copy"),document.body.removeChild(_)},I.hideButKeepEnabled=function(m){m.style.position="fixed",m.style.top="0",m.style.left="0",m.style.width="2em",m.style.height="2em",m.style.padding="0",m.style.border="none",m.style.outline="none",m.style.boxShadow="none",m.style.background="transparent"},I.convertBrToNewLine=function(m){return m=m.replace(/<br\s*[\/]?>/gi,`
`)},I}(),v=function(){function I(){}return I.float32ColorToARGB=function(m){return[(4278190080&m)>>>24,(16711680&m)>>>16,(65280&m)>>>8,255&m]},I._componentToHex=function(m){var _=m.toString(16);return _.length==1?"0"+_:_},I.rgbToHexString=function(m){return I.coalesce(m),"#"+I._componentToHex(m[0])+I._componentToHex(m[1])+I._componentToHex(m[2])},I.argbToHexString=function(m){return"#"+I._componentToHex(m[0])+I._componentToHex(m[1])+I._componentToHex(m[2])+I._componentToHex(m[3])},I.coalesce=function(m){for(var _=1;_<m.length;_++)m[_]===void 0&&(m[_]=m[_-1])},I}(),f=function(){function I(){}return I.getTimeStamp=function(){return new Date().getTime()},I}(),l=function(){function I(){}return I.getPixelRatio=function(m){return(window.devicePixelRatio||1)/(m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1)},I.isTouch=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints>0},I}(),g=function(){function I(){}return I.isInIFrame=function(){try{return window.self!==window.top}catch{return!0}},I.supportsFullscreen=function(){var m=document.documentElement;return(m.requestFullscreen||m.mozRequestFullScreen||m.webkitRequestFullScreen||m.msRequestFullscreen)!==void 0},I.isHidden=function(){return!!I.getHiddenProp()},I.getHiddenProp=function(){var m=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var _=0;_<m.length;_++)if(m[_]+"Hidden"in document)return m[_]+"Hidden";return null},I}(),h=function(){function I(){}return I.debounce=function(m,_){return _=_||100,function(){if(!m.debouncing){var T=Array.prototype.slice.apply(arguments);m.lastReturnVal=m.apply(window,T),m.debouncing=!0}return clearTimeout(m.debounceTimeout),m.debounceTimeout=setTimeout(function(){m.debouncing=!1},_),m.lastReturnVal}},I}(),e=function(){function I(){}return I.simplifyMimeType=function(m){switch(m){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var _=m.split("/");return _[_.length-1]}},I}(),t=function(){function I(){}return I.getCharCode=function(m){return typeof m.which=="number"?m.which:m.keyCode},I}(),n=function(){function I(){}return I.normalise=function(m,_,T){return(m-_)/(T-_)},I.median=function(m){m.sort(function(T,O){return T-O});var _=Math.floor(m.length/2);return m.length%2?m[_]:(m[_-1]+m[_])/2},I.clamp=function(m,_,T){return Math.min(Math.max(m,_),T)},I}(),r=function(I,m){this.width=I,this.height=m},d=function(){function I(){}return I.fitRect=function(m,_,T,O){var L,P=0,mt=0;return _/m<O/T?(P=m*(L=T/m),mt=_*L):(P=m*(L=O/_),mt=_*L),new r(Math.floor(P),Math.floor(mt))},I.hitRect=function(m,_,T,O,L,P){return L>m&&L<m+T&&P>_&&P<_+O},I}(),b=function(){function I(){}return I.numericalInput=function(m){return m.keyCode==46||m.keyCode==8||m.keyCode==9||m.keyCode==27||m.keyCode==65&&m.ctrlKey===!0||m.keyCode>=35&&m.keyCode<=39||!(m.shiftKey||(m.keyCode<48||m.keyCode>57)&&(m.keyCode<96||m.keyCode>105))||(m.preventDefault(),!1)},I}(),S=function(){function I(){}return I.toPlainObject=function(m){m=Object(m);var _={};for(var T in m)_[T]=m[T];return _},I}(),y=function(){function I(){}return I.clear=function(m){switch(m===void 0&&(m=u.MEMORY),m){case u.MEMORY:this._memoryStorage={};break;case u.SESSION:sessionStorage.clear();break;case u.LOCAL:localStorage.clear()}},I.clearExpired=function(m){m===void 0&&(m=u.MEMORY);for(var _=this.getItems(m),T=0;T<_.length;T++){var O=_[T];this._isExpired(O)&&this.remove(O.key)}},I.get=function(m,_){_===void 0&&(_=u.MEMORY);var T=null;switch(_){case u.MEMORY:T=this._memoryStorage[m];break;case u.SESSION:T=sessionStorage.getItem(m);break;case u.LOCAL:T=localStorage.getItem(m)}if(!T)return null;var O=null;try{O=JSON.parse(T)}catch{return null}return O?this._isExpired(O)?null:(O.key=m,O):null},I._isExpired=function(m){return!(new Date().getTime()<m.expiresAt)},I.getItems=function(m){m===void 0&&(m=u.MEMORY);var _=[];switch(m){case u.MEMORY:for(var T=Object.keys(this._memoryStorage),O=0;O<T.length;O++)(P=this.get(T[O],u.MEMORY))&&_.push(P);break;case u.SESSION:for(O=0;O<sessionStorage.length;O++)(L=sessionStorage.key(O))&&(P=this.get(L,u.SESSION))&&_.push(P);break;case u.LOCAL:for(O=0;O<localStorage.length;O++){var L,P;(L=localStorage.key(O))&&(P=this.get(L,u.LOCAL))&&_.push(P)}}return _},I.remove=function(m,_){switch(_===void 0&&(_=u.MEMORY),_){case u.MEMORY:delete this._memoryStorage[m];break;case u.SESSION:sessionStorage.removeItem(m);break;case u.LOCAL:localStorage.removeItem(m)}},I.set=function(m,_,T,O){O===void 0&&(O=u.MEMORY);var L=1e3*T,P=new A;switch(P.value=_,P.expiresAt=new Date().getTime()+L,O){case u.MEMORY:this._memoryStorage[m]=JSON.stringify(P);break;case u.SESSION:sessionStorage.setItem(m,JSON.stringify(P));break;case u.LOCAL:localStorage.setItem(m,JSON.stringify(P))}return P},I._memoryStorage={},I}(),A=function(){};(function(I){I.MEMORY="memory",I.SESSION="session",I.LOCAL="local"})(u||(u={}));var C=function(){function I(){}return I.ellipsis=function(m,_){if(m.length<=_)return m;var T=m.substr(0,_),O=T.lastIndexOf(" ");return O!=-1&&(T=T.substr(0,Math.min(T.length,O))),T+"&hellip;"},I.htmlDecode=function(m){var _=document.createElement("div");return _.innerHTML=m,_.firstChild.nodeValue},I.format=function(m){for(var _=[],T=1;T<arguments.length;T++)_[T-1]=arguments[T];for(var O=0;O<_.length;O++){var L=new RegExp("\\{"+O+"\\}","gm");m=m.replace(L,_[O])}return m},I.isAlphanumeric=function(m){return/^[a-zA-Z0-9]*$/.test(m)},I.toCssClass=function(m){return m.replace(/[^a-z0-9]/g,function(_){var T=_.charCodeAt(0);return T==32?"-":T>=65&&T<=90?"_"+_.toLowerCase():"__"+("000"+T.toString(16)).slice(-4)})},I.toFileName=function(m){return m.replace(/[^a-z0-9]/gi,"_").toLowerCase()},I.utf8_to_b64=function(m){return window.btoa(unescape(encodeURIComponent(m)))},I}(),x=function(){function I(){}return I.getHashParameter=function(m,_){return _||(_=window.document),_&&_.location?this.getHashParameterFromString(m,_.location.hash):null},I.getHashParameterFromString=function(m,_){var T=new RegExp("#.*[?&]"+m+"=([^&]+)(&|$)").exec(_);return T?decodeURIComponent(T[1].replace(/\+/g," ")):null},I.setHashParameter=function(m,_,T){if(T||(T=window.document),T&&T.location){var O="#?"+this.updateURIKeyValuePair(T.location.hash.replace("#?",""),m,_),L=T.URL;L.indexOf("#")!=-1&&(L=L.substr(0,L.indexOf("#"))),T.location.replace(L+O)}},I.getQuerystringParameter=function(m,_){return _||(_=window),this.getQuerystringParameterFromString(m,_.location.search)},I.getQuerystringParameterFromString=function(m,_){m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var T=new RegExp("[\\?&]"+m+"=([^&#]*)").exec(_);return T?decodeURIComponent(T[1].replace(/\+/g," ")):null},I.setQuerystringParameter=function(m,_,T){if(T||(T=window.document),T&&T.location){var O=this.updateURIKeyValuePair(T.location.hash.replace("#?",""),m,_);window.location.search=O}},I.updateURIKeyValuePair=function(m,_,T){_=encodeURIComponent(_),T=encodeURIComponent(T);var O=m.split("&");O[0]==""&&O.shift();for(var L,P=O.length;P--;)if((L=O[P].split("="))[0]==_){L[1]=T,O[P]=L.join("=");break}return P<0&&(O[O.length]=[_,T].join("=")),O.join("&")},I.getUrlParts=function(m){var _=document.createElement("a");return _.href=m,_},I.convertToRelativeUrl=function(m){var _=this.getUrlParts(m),T=_.pathname+_.searchWithin;return T.startsWith("/")||(T="/"+T),T},I}()}])})});var at=class{constructor(i,a){this.informationType=i;this.param=a}};var Z;(function(a){a[a.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",a[a.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"})(Z||(Z={}));var dt=class{};dt.FORBIDDEN="forbiddenResourceMessage";var it=X(bt());var J=X(Et());var qt=window.$,H=class{static loadExternalResources(i,a){return new Promise(u=>{it.Utils.loadExternalResourcesAuth09(i,a,H.clickThrough,H.restricted,H.login,H.getAccessToken,H.storeAccessToken,H.getStoredAccessToken,H.handleExternalResourceResponse).then(c=>{u(c)}).catch(c=>{switch(c.name){case it.StatusCode.AUTHORIZATION_FAILED.toString():H.publish(E.LOGIN_FAILED);break;case it.StatusCode.FORBIDDEN.toString():H.publish(E.FORBIDDEN);break;case it.StatusCode.RESTRICTED.toString():break;default:H.publish(E.SHOW_MESSAGE,[c.message||c])}})})}static clickThrough(i){return new Promise(a=>{H.publish(E.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:i,acceptCallback:()=>{if(i.clickThroughService){let u=window.open(i.clickThroughService.id),c=window.setInterval(()=>{u&&u.closed&&(window.clearInterval(c),H.publish(E.CLICKTHROUGH),a())},500)}}}])})}static restricted(i){return new Promise((a,u)=>{H.publish(E.SHOW_RESTRICTED_DIALOGUE,[{resource:i,acceptCallback:()=>{H.publish(w.LOAD_FAILED),u(i)}}])})}static login(i){return new Promise(a=>{let u={};i.status===J.FORBIDDEN&&(u.warningMessage=dt.FORBIDDEN,u.showCancelButton=!0),H.publish(E.SHOW_LOGIN_DIALOGUE,[{resource:i,loginCallback:()=>{if(i.loginService){let c=window.open(i.loginService.id+"?t="+new Date().getTime()),p=window.setInterval(function(){c&&c.closed&&(window.clearInterval(p),H.publish(E.LOGIN),a())},500)}},logoutCallback:()=>{if(i.logoutService){let c=window.open(i.logoutService.id+"?t="+new Date().getTime()),p=window.setInterval(function(){c&&c.closed&&(window.clearInterval(p),H.publish(E.LOGOUT),a())},500)}},options:u}])})}static getAccessToken(i,a){return new Promise((u,c)=>{if(i.tokenService){let p=i.tokenService.id,s=p+"|"+new Date().getTime(),v=l=>{window.removeEventListener("message",v);let g=l.data;g.error?c(a?g.errorDescription:void 0):u(g)};window.addEventListener("message",v,!1);let f=p+"?messageId="+s;qt("#commsFrame").prop("src",f)}else c("Token service not found")})}static storeAccessToken(i,a,u){return new Promise((c,p)=>{i.tokenService?(V.set(i.tokenService.id,a,a.expiresIn,u),c()):p("Token service not found")})}static getStoredAccessToken(i,a){return new Promise((u,c)=>{let p=[],s=null;if(i.tokenService&&(s=V.get(i.tokenService.id,a)),s)p.push(s);else{let f=j.getUrlParts(i.dataUri).hostname,l=V.getItems(a);for(let g=0;g<l.length;g++)s=l[g],s.key.includes(f)&&p.push(s)}p=p.sort((f,l)=>f.expiresAt-l.expiresAt);let v;p.length&&(v=p[p.length-1].value,u(v))})}static handleExternalResourceResponse(i){return new Promise((a,u)=>{if(i.isResponseHandled=!0,i.status===J.OK)a(i);else if(i.status===J.MOVED_TEMPORARILY)a(i),H.publish(E.RESOURCE_DEGRADED,[i]);else if(i.error.status===J.UNAUTHORIZED||i.error.status===J.INTERNAL_SERVER_ERROR)u(i.error.statusText);else if(i.error.status===J.FORBIDDEN){let c=new Error;c.message="Forbidden",c.name=it.StatusCode.FORBIDDEN.toString(),u(c)}else u(i.error.statusText)})}static handleDegraded(i){let a=new at(Z.DEGRADED_RESOURCE,i);H.publish(E.SHOW_INFORMATION,[a])}};var ot=X(bt());var kt=X(Et()),Yt=window.$,M=class{static loadExternalResources(i,a,u){return new Promise(c=>{M.storageStrategy=a,i=i.map(p=>(p.authAPIVersion=1,p.options=u,p)),ot.Utils.loadExternalResourcesAuth1(i,M.openContentProviderInteraction,M.openTokenService,M.getStoredAccessToken,M.userInteractedWithContentProvider,M.getContentProviderInteraction,M.handleMovedTemporarily,M.showOutOfOptionsMessages).then(p=>{c(p)}).catch(p=>{switch(p.name){case ot.StatusCode.AUTHORIZATION_FAILED.toString():M.publish(E.LOGIN_FAILED);break;case ot.StatusCode.FORBIDDEN.toString():M.publish(E.FORBIDDEN);break;case ot.StatusCode.RESTRICTED.toString():break;default:M.publish(E.SHOW_MESSAGE,[p.message||p])}})})}static getCookieServiceUrl(i){return i.id+"?origin="+M.getOrigin()}static openContentProviderInteraction(i){let a=M.getCookieServiceUrl(i);return window.open(a)}static getOrigin(i){let a=window.location;return i&&(a=document.createElement("a"),a.href=i),a.protocol+"//"+a.hostname+(a.port?":"+a.port:"")}static userInteractedWithContentProvider(i){return new Promise(a=>{let u=window.setInterval(()=>{i.closed&&(window.clearInterval(u),a(!0))},500)})}static handleMovedTemporarily(i){return new Promise(a=>{M.showDegradedMessage(i),i.isResponseHandled=!0,a()})}static showDegradedMessage(i){let a=new at(Z.DEGRADED_RESOURCE,i);M.publish(E.SHOW_INFORMATION,[a])}static storeAccessToken(i,a){return new Promise((u,c)=>{i.tokenService?(V.set(i.tokenService.id,a,a.expiresIn,M.storageStrategy),u()):c("Token service not found")})}static getStoredAccessToken(i){return new Promise((a,u)=>{let c=[],p=null;if(i.tokenService&&(p=V.get(i.tokenService.id,M.storageStrategy)),p)c.push(p);else{let v=j.getUrlParts(i.dataUri).hostname,f=V.getItems(M.storageStrategy);for(let l=0;l<f.length;l++)p=f[l],p.key.includes(v)&&c.push(p)}c=c.sort((v,f)=>v.expiresAt-f.expiresAt);let s=null;c.length&&(s=c[c.length-1].value),a(s)})}static getContentProviderInteraction(i,a){return new Promise(u=>{i.isResponseHandled&&!i.authHoldingPage?(M.showDegradedMessage(i),u(null)):i.authHoldingPage?(i.authHoldingPage.location.href=M.getCookieServiceUrl(a),u(i.authHoldingPage)):M.publish(E.SHOW_AUTH_DIALOGUE,[{service:a,closeCallback:()=>{u(null)},confirmCallback:()=>{let c=M.openContentProviderInteraction(a);u(c)},cancelCallback:()=>{u(null)}}])})}static openTokenService(i,a){return new Promise((u,c)=>{let p=M.getOrigin(a.id),s=new Date().getTime();M.messages[s]={resolve:u,reject:c,serviceOrigin:p,resource:i},window.addEventListener("message",M.receiveToken,!1);let v=a.id+"?messageId="+s+"&origin="+M.getOrigin();Yt("#commsFrame").prop("src",v);let f=5e3;setTimeout(()=>{M.messages[s]&&(M.messages[s].reject("Message unhandled after "+f+"ms, rejecting"),delete M.messages[s])},f)})}static receiveToken(i){if(i.data.hasOwnProperty("messageId")){let a=M.messages[i.data.messageId];a&&i.origin==a.serviceOrigin&&M.storeAccessToken(a.resource,i.data).then(()=>{a.resolve(i.data),delete M.messages[i.data.messageId]})}}static showOutOfOptionsMessages(i,a){if(i.status==kt.MOVED_TEMPORARILY)return;let u="";a.getFailureHeader()&&(u+="<p>"+a.getFailureHeader()+"</p>"),a.getFailureDescription()&&(u+=a.getFailureDescription()),M.publish(E.SHOW_MESSAGE,[Q(u)])}},lt=M;lt.messages={};var _t=class{constructor(i,a,u){this.isResized=!1;this.$element=i,this.fitToParentWidth=a||!1,this.fitToParentHeight=u||!1,this.create()}create(){this.extensionHost?.subscribe(w.RESIZE,()=>{this.resize()})}whenResized(i){Mt.waitFor(()=>this.isResized,i)}onAccessibleClick(i,a,u=!0){u&&i.on("click",c=>{a(c)}),i.on("keyup",c=>{c.keyCode===32&&a(c)})}resize(){let i=this.$element.parent();this.fitToParentWidth&&this.$element.width(i.width()),this.fitToParentHeight&&this.$element.height(i.height()),this.isResized=!0}};var Xt=window.$,D=class extends _t{constructor(i,a,u){super(i,a,u)}create(){this.extensionHost=this.$element.closest(".uv-iiif-extension-host").data("component"),super.create(),this.extension=this.extensionHost.extension,this.config={},this.config.content={},this.config.options={};var i=this;i.modules&&i.modules.length&&(i.modules=i.modules.reverse(),i.modules.forEach(a=>{i.config=Xt.extend(!0,i.config,i.extension.data.config.modules[a])})),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(i){this.modules||(this.modules=[]),this.modules.push(i)}resize(){super.resize()}};var nt=window.$,F=class extends D{constructor(i){super(i,!1,!1);this.allowClose=!0;this.isActive=!1;this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.extensionHost.subscribe(E.CLOSE_ACTIVE_DIALOGUE,()=>{this.isActive&&this.allowClose&&this.close()}),this.extensionHost.subscribe(E.ESCAPE,()=>{this.isActive&&this.allowClose&&this.close()}),this.$top=nt('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=nt('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=nt('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=nt('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=nt('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=nt('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",i=>{i.preventDefault(),this.close()}),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let i=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),a=0,u=0,c=0;if(this.$triggerButton){let p=4,s=2,v=this.$triggerButton.offset().top,f=this.extension.$element.offset().top,l=this.$element.outerHeight(!0);i=v-f-l+p;let h=this.$triggerButton.offset().left,e=this.extension.$element.offset().left,t=h-e;c=wt.normalise(t,0,this.extension.width()),a=Math.floor(this.extension.width()*c-this.$element.width()*c)+s,u=Math.floor(this.$element.width()*c)}this.$bottom.css("backgroundPosition",u+"px 0px"),this.$element.css({top:i,left:a})}open(i){this.$element.attr("aria-hidden","false"),this.$element.show(),i?(this.$triggerButton=nt(i),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(()=>{let a=this.$element.find(".default");if(a.length)a.focus();else{let u=this.$element.find("input:visible").first();u.length?u.focus():this.$closeButton.focus()}},1),this.extensionHost.publish(E.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.extensionHost.publish(this.closeCommand),this.extensionHost.publish(E.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}};var Ft=window.$,It=class extends F{constructor(i){super(i)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=E.SHOW_AUTH_DIALOGUE,this.closeCommand=E.HIDE_AUTH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{let a=Array.isArray(i)?i[0]:i;this.closeCallback=a.closeCallback,this.confirmCallback=a.confirmCallback,this.cancelCallback=a.cancelCallback,this.service=a.service,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Ft('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",i=>{i.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()})}open(){if(!this.service){console.error("NO SERVICE");return}super.open();let i=this.service.getHeader(),a=this.service.getDescription(),u=this.service.getConfirmLabel();i&&this.$title.text(Q(i)),a&&(this.$message.html(Q(a)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){let c=Ft(this).attr("href");this.extensionHost.publish(E.EXTERNAL_LINK_CLICKED,c)})),u&&this.$confirmButton.text(Q(u)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var i='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(i+='<button class="close btn btn-default"></button>'),i}};var Ut=window.$,St=class extends F{constructor(i){super(i)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=E.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=E.HIDE_CLICKTHROUGH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Ut('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",i=>{i.preventDefault(),this.close(),this.extensionHost.publish(E.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()})}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var i=Ut(this).attr("href");this.extensionHost.publish(E.EXTERNAL_LINK_CLICKED,i)}),this.resize()}resize(){super.resize()}};var Dt=window.$,Tt=class extends F{constructor(i){super(i)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=E.SHOW_LOGIN_DIALOGUE,this.closeCommand=E.HIDE_LOGIN_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.loginCallback=i.loginCallback,this.logoutCallback=i.logoutCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Dt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",i=>{i.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()}),this.$logoutButton.on("click",i=>{i.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()}),this.updateLogoutButton()}open(){super.open();let i="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),i=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(i='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+i+"</span>"),this.updateLogoutButton(),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var a=Dt(this).attr("href");this.extensionHost.publish(E.EXTERNAL_LINK_CLICKED,a)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}};var Gt=window.$,$t=class extends F{constructor(i){super(i)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=E.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=E.HIDE_RESTRICTED_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Gt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()})}open(){super.open(),this.isAccepted=!1;let i="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),i=this.resource.restrictedService.getProperty("description")),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var a=Gt(this).attr("href");this.extensionHost.publish(E.EXTERNAL_LINK_CLICKED,a)}),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}};var Vt=window.$,xt=class extends F{constructor(i){super(i)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=E.SHOW_GENERIC_DIALOGUE,this.closeCommand=E.HIDE_GENERIC_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.showMessage(i)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$message=Vt("<p></p>"),this.$content.append(this.$message),this.$acceptButton=Vt(`
          <button class="btn btn-primary accept default">
            ${this.content.ok}
          </button>
        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(()=>{this.accept()}),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.extensionHost.publish(E.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(i){this.$message.html(i.message),i.buttonText?this.$acceptButton.text(i.buttonText):this.$acceptButton.text(this.content.ok),i.allowClose===!1&&this.disableClose(),this.open()}resize(){super.resize()}};var W=window.$,yt=class extends D{constructor(i){super(i,!0,!0)}create(){super.create(),this.extensionHost.subscribe(E.SHOW_OVERLAY,()=>{this.$overlays.show()}),this.extensionHost.subscribe(E.HIDE_OVERLAY,()=>{this.$overlays.hide()}),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=W('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=W('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=W('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=W('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=W('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=W('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=W('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=W('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=W('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",i=>{W(i.target).hasClass("overlays")&&(i.preventDefault(),this.extensionHost.publish(E.CLOSE_ACTIVE_DIALOGUE))}),new xt(this.$genericDialogue)}resize(){super.resize(),setTimeout(()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())},1);let i=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(U(this.$headerPanel)?this.$headerPanel.height():0)-(U(this.$footerPanel)?this.$footerPanel.height():0)-(U(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(i)}};var N=X(Ht()),tt=X(Et()),G=X(bt()),Ct=class{constructor(i,a){this.authHoldingPage=null;this.clickThroughService=null;this.externalService=null;this.isProbed=!1;this.isResponseHandled=!1;this.kioskService=null;this.loginService=null;this.logoutService=null;this.probeService=null;this.restrictedService=null;this.tokenService=null;i.externalResource=this,this.dataUri=this._getDataUri(i),this.index=i.index,this.authAPIVersion=a.authApiVersion,this._parseAuthServices(i),this._parseCanvasDimensions(i)}_getImageServiceDescriptor(i){let a=null;for(let u=0;u<i.length;u++){let c=i[u],p=c.id;p.endsWith("/")||(p+="/"),c.getProfile()&&(G.Utils.isImageProfile(c.getProfile())||G.Utils.isImageServiceType(c.getIIIFResourceType()))&&(a=p+"info.json")}return a}_getDataUri(i){let a=i.getContent(),u=i.getImages(),c=null;if(console.log("_getDataUri"),a&&a.length){let s=a[0].getBody();if(s.length){let f=s[0].getServices();return f.length&&(c=this._getImageServiceDescriptor(f),c)?c:s[0].id}return null}else if(u&&u.length){let s=u[0].getResource(),v=s.getServices();return v.length&&(c=this._getImageServiceDescriptor(v),c)?c:s.id}else{let p=i.getService(N.ServiceProfile.IXIF);return p?p.getInfoUri():i.id}}_parseAuthServices(i){if(this.authAPIVersion===.9)this.clickThroughService=G.Utils.getService(i,N.ServiceProfile.AUTH_0_CLICK_THROUGH),this.loginService=G.Utils.getService(i,N.ServiceProfile.AUTH_0_LOGIN),this.restrictedService=G.Utils.getService(i,N.ServiceProfile.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(N.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(N.ServiceProfile.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(N.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(N.ServiceProfile.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(N.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(N.ServiceProfile.AUTH_0_TOKEN));else{if(i.isCanvas!==void 0&&i.isCanvas()){let a=i.getContent();if(a&&a.length){let u=a[0].getBody();u&&u.length&&(i=u[0])}}this.clickThroughService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_CLICK_THROUGH),this.loginService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_LOGIN),this.externalService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_EXTERNAL),this.kioskService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(N.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(N.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(N.ServiceProfile.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(N.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(N.ServiceProfile.AUTH_1_TOKEN),this.probeService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_PROBE),this.probeService||(this.probeService=this.loginService.getService(N.ServiceProfile.AUTH_1_PROBE))):this.externalService?(this.logoutService=this.externalService.getService(N.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(N.ServiceProfile.AUTH_1_TOKEN),this.probeService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_PROBE),this.probeService||(this.probeService=this.externalService.getService(N.ServiceProfile.AUTH_1_PROBE))):this.kioskService&&(this.logoutService=this.kioskService.getService(N.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(N.ServiceProfile.AUTH_1_TOKEN),this.probeService=G.Utils.getService(i,N.ServiceProfile.AUTH_1_PROBE),this.probeService||(this.probeService=this.kioskService.getService(N.ServiceProfile.AUTH_1_PROBE)))}}_parseCanvasDimensions(i){let a=i.getImages();if(a&&a.length){let c=a[0].getResource();this.width=c.getWidth(),this.height=c.getHeight()}else if(a=i.getContent(),a.length){let c=a[0].getBody();c.length&&(this.width=c[0].getWidth(),this.height=c[0].getHeight())}}_parseDescriptorDimensions(i){i.width!==void 0&&(this.width=i.width),i.height!==void 0&&(this.height=i.height)}isAccessControlled(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)}hasServiceDescriptor(){return this.dataUri?this.dataUri.endsWith("info.json"):!1}getData(i){console.log("getData",this.dataUri);let a=this;return a.data={},new Promise((u,c)=>{if(!a.dataUri){c("There is no dataUri to fetch");return}if(a.probeService){a.isProbed=!0;let p=new XMLHttpRequest;p.open("GET",a.probeService.id,!0),p.withCredentials=!0,p.onload=()=>{let s=JSON.parse(p.responseText);unescape(s.contentLocation)!==a.dataUri?a.status=tt.MOVED_TEMPORARILY:a.status=tt.OK,a.data=s,u(a)},p.onerror=()=>{a.status=p.status,u(a)},p.send()}else{let p="GET";if(!a.hasServiceDescriptor()){if(!a.isAccessControlled()){a.status=tt.OK,u(a);return}p="HEAD"}let s=new XMLHttpRequest;s.open(p,a.dataUri,!0),i&&s.setRequestHeader("Authorization","Bearer "+i.accessToken),s.onload=()=>{if(!s.responseText)a.status=tt.OK,u(a);else{let v=JSON.parse(s.responseText),f=unescape(v["@id"]);a.data=v,a._parseAuthServices(a.data),a._parseDescriptorDimensions(a.data),f.endsWith("/info.json")&&(f=f.substr(0,f.lastIndexOf("/")));let l=a.dataUri;l&&l.endsWith("/info.json")&&(l=l.substr(0,l.lastIndexOf("/"))),f!==l&&a.loginService?a.status=tt.MOVED_TEMPORARILY:a.status=tt.OK,u(a)}},s.onerror=()=>{a.status=s.status,s.responseText&&a._parseAuthServices(JSON.parse(s.responseText)),u(a)},s.send()}})}};var Qt=X(Ht());var k;(function(o){o[o.Backspace=8]="Backspace",o[o.Tab=9]="Tab",o[o.Enter=13]="Enter",o[o.Shift=16]="Shift",o[o.Ctrl=17]="Ctrl",o[o.Alt=18]="Alt",o[o.PauseBreak=19]="PauseBreak",o[o.CapsLock=20]="CapsLock",o[o.Escape=27]="Escape",o[o.Spacebar=32]="Spacebar",o[o.PageUp=33]="PageUp",o[o.PageDown=34]="PageDown",o[o.End=35]="End",o[o.Home=36]="Home",o[o.LeftArrow=37]="LeftArrow",o[o.UpArrow=38]="UpArrow",o[o.RightArrow=39]="RightArrow",o[o.DownArrow=40]="DownArrow",o[o.PrintScrn=44]="PrintScrn",o[o.Insert=45]="Insert",o[o.Delete=46]="Delete",o[o.Zero=48]="Zero",o[o.One=49]="One",o[o.Two=50]="Two",o[o.Three=51]="Three",o[o.Four=52]="Four",o[o.Five=53]="Five",o[o.Six=54]="Six",o[o.Seven=55]="Seven",o[o.Eight=56]="Eight",o[o.Nine=57]="Nine",o[o.a=65]="a",o[o.b=66]="b",o[o.c=67]="c",o[o.d=68]="d",o[o.e=69]="e",o[o.f=70]="f",o[o.g=71]="g",o[o.h=72]="h",o[o.i=73]="i",o[o.j=74]="j",o[o.k=75]="k",o[o.l=76]="l",o[o.m=77]="m",o[o.n=78]="n",o[o.o=79]="o",o[o.p=80]="p",o[o.q=81]="q",o[o.r=82]="r",o[o.s=83]="s",o[o.t=84]="t",o[o.u=85]="u",o[o.v=86]="v",o[o.w=87]="w",o[o.x=88]="x",o[o.y=89]="y",o[o.z=90]="z",o[o.LeftWindowKey=91]="LeftWindowKey",o[o.RightWindowKey=92]="RightWindowKey",o[o.SelectKey=93]="SelectKey",o[o.Numpad0=96]="Numpad0",o[o.Numpad1=97]="Numpad1",o[o.Numpad2=98]="Numpad2",o[o.Numpad3=99]="Numpad3",o[o.Numpad4=100]="Numpad4",o[o.Numpad5=101]="Numpad5",o[o.Numpad6=102]="Numpad6",o[o.Numpad7=103]="Numpad7",o[o.Numpad8=104]="Numpad8",o[o.Numpad9=105]="Numpad9",o[o.Multiply=106]="Multiply",o[o.NumpadPlus=107]="NumpadPlus",o[o.NumpadMinus=109]="NumpadMinus",o[o.DecimalPoint=110]="DecimalPoint",o[o.Divide=111]="Divide",o[o.F1=112]="F1",o[o.F2=113]="F2",o[o.F3=114]="F3",o[o.F4=115]="F4",o[o.F5=116]="F5",o[o.F6=117]="F6",o[o.F7=118]="F7",o[o.F8=119]="F8",o[o.F9=120]="F9",o[o.F10=121]="F10",o[o.F11=122]="F11",o[o.F12=123]="F12",o[o.NumLock=144]="NumLock",o[o.ScrollLock=145]="ScrollLock",o[o.Semicolon=186]="Semicolon",o[o.Equals=187]="Equals",o[o.Comma=188]="Comma",o[o.LessThan=188]="LessThan",o[o.Dash=189]="Dash",o[o.Period=190]="Period",o[o.GreaterThan=190]="GreaterThan",o[o.ForwardSlash=191]="ForwardSlash",o[o.QuestionMark=191]="QuestionMark",o[o.GraveAccent=192]="GraveAccent",o[o.Tilde=192]="Tilde",o[o.OpenCurlyBracket=219]="OpenCurlyBracket",o[o.OpenSquareBracket=219]="OpenSquareBracket",o[o.BackSlash=220]="BackSlash",o[o.VerticalPipe=220]="VerticalPipe",o[o.CloseCurlyBracket=221]="CloseCurlyBracket",o[o.CloseSquareBracket=221]="CloseSquareBracket",o[o.Quote=222]="Quote",o[o.CommandFF=224]="CommandFF"})(k||(k={}));var jt;(function(o){o[o.Backspace=8]="Backspace",o[o.Enter=13]="Enter",o[o.Spacebar=32]="Spacebar",o[o.Hash=35]="Hash",o[o.GraveAccent=39]="GraveAccent",o[o.DoubleQuote=34]="DoubleQuote",o[o.Asterisk=42]="Asterisk",o[o.Plus=43]="Plus",o[o.Comma=44]="Comma",o[o.Minus=45]="Minus",o[o.Period=46]="Period",o[o.ForwardSlash=47]="ForwardSlash",o[o.Zero=48]="Zero",o[o.One=49]="One",o[o.Two=50]="Two",o[o.Three=51]="Three",o[o.Four=52]="Four",o[o.Five=53]="Five",o[o.Six=54]="Six",o[o.Seven=55]="Seven",o[o.Eight=56]="Eight",o[o.Nine=57]="Nine",o[o.Colon=58]="Colon",o[o.Semicolon=59]="Semicolon",o[o.LessThan=60]="LessThan",o[o.Equals=61]="Equals",o[o.GreaterThan=62]="GreaterThan",o[o.QuestionMark=63]="QuestionMark",o[o.At=64]="At",o[o.OpenSquareBracket=91]="OpenSquareBracket",o[o.BackSlash=92]="BackSlash",o[o.CloseSquareBracket=93]="CloseSquareBracket",o[o.a=97]="a",o[o.b=98]="b",o[o.c=99]="c",o[o.d=100]="d",o[o.e=101]="e",o[o.f=102]="f",o[o.g=103]="g",o[o.h=104]="h",o[o.i=105]="i",o[o.j=106]="j",o[o.k=107]="k",o[o.l=108]="l",o[o.m=109]="m",o[o.n=110]="n",o[o.o=111]="o",o[o.p=112]="p",o[o.q=113]="q",o[o.r=114]="r",o[o.s=115]="s",o[o.t=116]="t",o[o.u=117]="u",o[o.v=118]="v",o[o.w=119]="w",o[o.x=120]="x",o[o.y=121]="y",o[o.z=122]="z",o[o.OpenCurlyBracket=123]="OpenCurlyBracket",o[o.VerticalPipe=124]="VerticalPipe",o[o.CloseCurlyBracket=125]="CloseCurlyBracket",o[o.Tilde=126]="Tilde"})(jt||(jt={}));var q=window.$,Zt=class{constructor(){this.annotations=[];this.isCreated=!1;this.isLoggedIn=!1;this.metrics=[];this.shifted=!1;this.tabbing=!1;this.locales={}}create(){let i=this;if(this.browserDetect=new Jt,this.browserDetect.init(),H.publish=this.extensionHost.publish.bind(this.extensionHost),lt.publish=this.extensionHost.publish.bind(this.extensionHost),this.$element=q(this.extensionHost.options.target),this.$element.data("component",this.extensionHost),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-iiif-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.isRightPanelEnabled()&&this.$element.addClass("right-panel-enabled"),this.isLeftPanelEnabled()&&this.$element.addClass("left-panel-enabled"),this.isFooterPanelEnabled()&&this.$element.addClass("footer-panel-enabled"),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),K.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",a=>{this.mouseX=a.pageX,this.mouseY=a.pageY}),!this.data.isReload){let a=K.getHiddenProp();if(a){let u=a.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(u,()=>{K.isHidden()||this.resize()})}R.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",u=>{u.preventDefault();let c=u.originalEvent.dataTransfer.getData("URL"),p=j.getUrlParts(c),s=j.getQuerystringParameterFromString("manifest",p.search);if(s||(s=j.getQuerystringParameterFromString("collection",p.search)),s){this.fire(w.DROP,s);let v={};v.iiifManifestId=s,this.reload(v)}}),this.$element.on("dragover",u=>{u.preventDefault()}),this.$element.on("keyup keydown",u=>{this.shifted=u.shiftKey,this.tabbing=u.keyCode===k.Tab}),this.$element.on("keydown",u=>{let c=null,p=!0;!u.ctrlKey&&!u.altKey&&!u.shiftKey&&(u.keyCode===k.Enter&&(c=E.RETURN,p=!1),u.keyCode===k.Escape&&(c=E.ESCAPE),u.keyCode===k.PageUp&&(c=E.PAGE_UP),u.keyCode===k.PageDown&&(c=E.PAGE_DOWN),u.keyCode===k.End&&(c=E.END),u.keyCode===k.Home&&(c=E.HOME),(u.keyCode===k.NumpadPlus||u.keyCode===171||u.keyCode===k.Equals)&&(c=E.PLUS,p=!1),(u.keyCode===k.NumpadMinus||u.keyCode===173||u.keyCode===k.Dash)&&(c=E.MINUS,p=!1),i.useArrowKeysToNavigate()&&(u.keyCode===k.LeftArrow&&(c=E.LEFT_ARROW),u.keyCode===k.UpArrow&&(c=E.UP_ARROW),u.keyCode===k.RightArrow&&(c=E.RIGHT_ARROW),u.keyCode===k.DownArrow&&(c=E.DOWN_ARROW))),c&&(p&&u.preventDefault(),this.extensionHost.publish(c))})}this.extensionHost.subscribe(w.EXIT_FULLSCREEN,()=>{this.isOverlayActive()&&this.extensionHost.publish(E.ESCAPE),this.extensionHost.publish(E.ESCAPE),this.extensionHost.publish(w.RESIZE)}),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.extensionHost.subscribeAll((a,u)=>{[w.LOAD,w.DROP,w.TOGGLE_FULLSCREEN,w.EXTERNAL_RESOURCE_OPENED,w.RELOAD].includes(a)||this.fire(a,u)}),this.extensionHost.subscribe(w.EXTERNAL_RESOURCE_OPENED,()=>{this.fire(w.EXTERNAL_RESOURCE_OPENED)}),this.extensionHost.subscribe(E.LOGIN_FAILED,()=>{this.showMessage(this.data.config.content.authorisationFailedMessage)}),this.extensionHost.subscribe(E.LOGIN,()=>{this.isLoggedIn=!0}),this.extensionHost.subscribe(E.LOGOUT,()=>{this.isLoggedIn=!1}),this.extensionHost.subscribe(E.BOOKMARK,()=>{this.bookmark()}),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,a=>{this.data.canvasIndex=a,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=a}),this.extensionHost.subscribe(E.CLOSE_LEFT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(E.CLOSE_RIGHT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(E.COLLECTION_INDEX_CHANGE,a=>{this.data.collectionIndex=a}),this.extensionHost.subscribe(w.CREATED,()=>{this.isCreated=!0}),this.extensionHost.subscribe(E.ESCAPE,()=>{this.isFullScreen()&&!this.isOverlayActive()&&this.extensionHost.publish(w.TOGGLE_FULLSCREEN)}),this.extensionHost.subscribe(w.LOAD,()=>{setTimeout(()=>{this.extensionHost.publish(w.RESIZE),this.fire(w.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")},100)}),this.extensionHost.subscribe(E.FEEDBACK,()=>{this.feedback()}),this.extensionHost.subscribe(E.FORBIDDEN,()=>{this.extensionHost.publish(E.OPEN_EXTERNAL_RESOURCE)}),this.extensionHost.subscribe(w.LOAD_FAILED,()=>{!i.lastCanvasIndex==null&&i.lastCanvasIndex!==i.helper.canvasIndex&&this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,i.lastCanvasIndex)}),this.extensionHost.subscribe(E.MANIFEST_INDEX_CHANGE,a=>{this.data.manifestIndex=a}),this.extensionHost.subscribe(E.OPEN,()=>{let a=Nt.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(a)}),this.extensionHost.subscribe(E.OPEN_LEFT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(E.OPEN_RIGHT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(E.RANGE_CHANGE,a=>{a?(this.data.rangeId=a.id,this.helper.rangeId=a.id):(this.data.rangeId=void 0,this.helper.rangeId=void 0)}),this.extensionHost.subscribe(E.RESOURCE_DEGRADED,a=>{H.handleDegraded(a)}),this.extensionHost.subscribe(E.SHOW_MESSAGE,a=>{this.showMessage(a)}),this.extensionHost.subscribe(E.SHOW_TERMS_OF_USE,()=>{let a=this.helper.getLicense();if(!a){let u=this.helper.getRequiredStatement();u&&u.value&&(a=u.value)}a&&this.showMessage(a)}),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{let a=this.data.config.options.overrideFullScreen;this.extensionHost.isFullScreen=!this.extensionHost.isFullScreen,a||(q("#top").focus(),this.extensionHost.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(w.TOGGLE_FULLSCREEN,{isFullScreen:this.extensionHost.isFullScreen,overrideFullScreen:a})}),this.shell=new yt(this.$element),this.createModules(),this.extensionHost.publish(w.RESIZE),setTimeout(()=>{this.render(),this.extensionHost.publish(w.CREATED),this._setDefaultFocus()},1)}async loadConfig(i){let a=this.locales[i];if(!a)throw new Error("Unable to load config");return typeof a=="object"?a=JSON.parse(JSON.stringify(a)):typeof a=="function"&&(a=await a(),a=JSON.parse(JSON.stringify(a))),a}createModules(){this.$authDialogue=q('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new It(this.$authDialogue),this.$clickThroughDialogue=q('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new St(this.$clickThroughDialogue),this.$restrictedDialogue=q('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new $t(this.$restrictedDialogue),this.$loginDialogue=q('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new Tt(this.$loginDialogue)}_setDefaultFocus(){setTimeout(()=>{this.data.config.options.allowStealFocus&&q("[tabindex=0]").focus()},1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.extensionHost.publish(w.EXIT_FULLSCREEN)}fire(i,...a){this.data.debug&&console.log(i,arguments[1]),this.extensionHost.fire(i,arguments[1])}redirect(i){this.fire(E.REDIRECT,i)}refresh(){this.fire(E.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.extensionHost.publish(E.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&this.data.iiifManifestId!==void 0&&this.extensionHost.publish(E.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(this.data.canvasIndex===void 0&&(this.data.canvasIndex=0),this.data.canvasId&&(this.data.canvasIndex=this.helper.canvasIndex),this.extensionHost.publish(E.CANVAS_INDEX_CHANGE,this.data.canvasIndex)),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let i=this.helper.getRangeById(this.data.rangeId);i?this.extensionHost.publish(E.RANGE_CHANGE,i):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let i=this.data.config.localisation.locales.slice(0),a=this.data.locales,u=[];a?(a.forEach(p=>{let s=i.filter(f=>f.name===p.name);if(s.length){var v=s[0];p.label&&(v.label=p.label),v.added=!0,u.push(v)}}),R.getBool(this.data.config.options.limitLocales,!1)||i.forEach(p=>{p.added||u.push(p),delete p.added}),this.data.locales=u):console.warn("No locales configured")}_parseMetrics(){let i=this.data.config.options.metrics;if(i)for(let a=0;a<i.length;a++){let u=i[a];this.metrics.push(u)}}_updateMetric(){setTimeout(()=>{for(let a=this.metrics.length-1;a>=0;a--){let u=this.metrics[a];if(window.innerWidth>=u.minWidth){if(this.metric!==u.type){this.metric=u.type;for(var i=0;i<this.metrics.length;i++)this.$element.removeClass(this.metrics[i].type);this.$element.addClass(u.type),this.extensionHost.publish(E.METRIC_CHANGE)}break}}},1)}resize(){this._updateMetric(),this.extensionHost.publish(w.RESIZE)}reload(i){this.extensionHost.publish(w.RELOAD,i)}isSeeAlsoEnabled(){return this.data.config.options.seeAlsoEnabled!==!1}getShareUrl(){if(this.data.embedded){if(this.helper.hasRelatedPage()){var i=this.helper.getRelated();return i&&i.length&&(i=i[0]),i["@id"]}}else return K.isInIFrame()?parent.document.location.href:document.location.href;return null}getIIIFShareUrl(i=!1){let a;return i&&(this.helper.manifest?a=this.helper.manifest.id:a=this.helper.manifestUri),`${a}?manifest=${a}`}getDomain(){return j.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let i=V.get("uv.settings",ht.LOCAL);if(i)return q.extend(this.data.config.options,i.value)}return this.data.config.options}updateSettings(i){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let a=V.get("uv.settings",ht.LOCAL);a&&(i=q.extend(a.value,i)),V.set("uv.settings",i,31536e4,ht.LOCAL)}this.data.config.options=q.extend(this.data.config.options,i)}getLocale(){return this.helper.options.locale}getSharePreview(){let i=this.helper.getLabel(),a=this.helper.getCurrentCanvas(),u=a.getProperty("thumbnail");return(!u||typeof u!="string")&&(u=a.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:i,image:u}}getPagedIndices(i=this.helper.canvasIndex){return[i]}getCurrentCanvases(){let i=this.getPagedIndices(this.helper.canvasIndex),a=[];for(let u=0;u<i.length;u++){let c=i[u],p=this.helper.getCanvasByIndex(c);p&&a.push(p)}return a}getCanvasLabels(i){let a=this.getPagedIndices(),u="";if(a.length===1)u=i;else for(let c=1;c<=a.length;c++)u.length&&(u+=","),u+=i+" "+c;return u}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(i){let a=this.getPagedIndices(),u=[];a.forEach(s=>{let v=this.helper.getCanvasByIndex(s),f;if(v.externalResource?f=v.externalResource:f=new Ct(v,{authApiVersion:this.data.config.options.authAPIVersion}),i){let l=i.find(g=>g.dataUri===f.dataUri);l?u.push(l):u.push(f)}else u.push(f)});let c=this.data.config.options.tokenStorage;return this.data.config.options.authAPIVersion===1?new Promise(s=>{let v={locale:this.helper.options.locale};lt.loadExternalResources(u,c,v).then(f=>{this.resources=f.map(l=>this._prepareResourceData(l)),s(this.resources)})}):new Promise(s=>{H.loadExternalResources(u,c).then(v=>{this.resources=v.map(f=>this._prepareResourceData(f)),s(this.resources)})})}_prepareResourceData(i){return i.data.hasServiceDescriptor=i.hasServiceDescriptor(),i.data.index=i.index,Pt.toPlainObject(i.data)}getMediaFormats(i){let a=i.getContent();return a&&a.length?a[0].getBody():[{id:i.id,type:i.getType(),getFormat:function(){return""}}]}viewCanvas(i){if(this.helper.isCanvasIndexOutOfRange(i)){this.showMessage(this.data.config.content.canvasIndexOutOfRange);return}this.extensionHost.publish(E.OPEN_EXTERNAL_RESOURCE)}showMessage(i,a,u,c){this.closeActiveDialogue(),this.extensionHost.publish(E.SHOW_GENERIC_DIALOGUE,{message:i,acceptCallback:a,buttonText:u,allowClose:c})}closeActiveDialogue(){this.extensionHost.publish(E.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return U(this.shell.$overlays)}isDesktopMetric(){return this.metric==="lg"||this.metric==="xl"}isMobileMetric(){return this.metric==="sm"||this.metric==="md"}viewManifest(i){let a={};a.iiifManifestId=this.helper.manifestUri,a.collectionIndex=this.helper.getCollectionIndex(i),a.manifestIndex=i.index,a.canvasIndex=0,this.reload(a)}viewCollection(i){let a={};a.iiifManifestId=i.parentCollection?i.parentCollection.id:this.helper.manifestUri,a.collectionIndex=i.index,a.manifestIndex=0,a.canvasIndex=0,this.reload(a)}isFullScreen(){return this.extensionHost.isFullScreen}isHeaderPanelEnabled(){return R.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(R.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let i=this.helper.getViewingHint();if(!i||i&&i!==Qt.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return R.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return R.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}useArrowKeysToNavigate(){return R.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(E.FEEDBACK,this.data)}getAlternateLocale(){let i=null;return this.data.locales&&this.data.locales.length>1&&(i=this.data.locales[1]),i}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(i){let a="";for(let u=0;u<i.length;u++){let c=i[u];u>0&&(a+=","),a+=c.name,c.label&&(a+=":"+c.label)}return a}changeLocale(i){let a={};if(this.data.locales){a.locales=this.data.locales.slice(0);let u=a.locales.findIndex(p=>p.name===i),c=0;a.locales.splice(c,0,a.locales.splice(u,1)[0]),this.reload(a)}}dispose(){this.store?.destroy()}},Jt=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown",this.browser=="Explorer"&&this.version=="7"&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(i){for(var a=0;a<i.length;a++){var u=i[a].string;if(this.versionSearchString=i[a].subString,u.indexOf(i[a].subString)!=-1)return i[a].identity}}searchVersion(i){var a=i.indexOf(this.versionSearchString);if(a!=-1)return parseFloat(i.substring(a+this.versionSearchString.length+1))}searchVersionIE(){var i=navigator.userAgent.toString().toLowerCase(),a=/(trident)(?:.*rv:([\w.]+))?/.exec(i)||/(msie) ([\w.]+)/.exec(i)||["",null,-1],u="unknown";return a!==null&&a.length===3&&a[2]&&(u=a[2].split(".")[0]),u}};var z=window.$,Kt=class extends D{constructor(i){super(i)}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{this.updateFullScreenButton(),this.extensionHost.isFullScreen||setTimeout(()=>{this.resize()},1001)}),this.extensionHost.subscribe(E.METRIC_CHANGE,()=>{this.updateMinimisedButtons(),this.updateMoreInfoButton()}),this.extensionHost.subscribe(E.SETTINGS_CHANGE,()=>{this.updateDownloadButton()}),this.$options=z('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=z(`
          <button class="feedback btn imageBtn" title="${this.content.feedback}">
            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>
            <span class="sr-only">${this.content.feedback}</span>
          </button>
        `),this.$options.prepend(this.$feedbackButton),this.$openButton=z(`
          <button class="open btn imageBtn" title="${this.content.open}">
            <i class="uv-icon-open" aria-hidden="true"></i>
            <span class="sr-only">${this.content.open}</span>
          </button>
        `),this.$options.prepend(this.$openButton),this.$bookmarkButton=z(`
          <button class="bookmark btn imageBtn" title="${this.content.bookmark}">
            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>
            <span class="sr-only">${this.content.bookmark}</span>
          </button>
        `),this.$options.prepend(this.$bookmarkButton),this.$shareButton=z(`
          <button class="share btn imageBtn" title="${this.content.share}">
            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>
            <span class="sr-only">${this.content.share}</span>
          </button>
        `),this.$options.append(this.$shareButton),this.$embedButton=z(`
          <button class="embed btn imageBtn" title="${this.content.embed}">
            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>
            <span class="sr-only">${this.content.embed}</span>
          </button>
        `),this.$options.append(this.$embedButton),this.$downloadButton=z(`
          <button class="download btn imageBtn" title="${this.content.download}" id="download-btn">
            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>
            <span class="sr-only">${this.content.download}</span>
          </button>
        `),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=z(`
          <button class="moreInfo btn imageBtn" title="${this.content.moreInfo}">
            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>
            <span class="sr-only">${this.content.moreInfo}</span>
          </button>
        `),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=z(`
          <button class="fullScreen btn imageBtn" title="${this.content.fullScreen}">
            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>
            <span class="sr-only">${this.content.fullScreen}</span>
          </button>
        `),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed(()=>{this.extensionHost.publish(E.OPEN)}),this.$feedbackButton.onPressed(()=>{this.extensionHost.publish(E.FEEDBACK)}),this.$bookmarkButton.onPressed(()=>{this.extensionHost.publish(E.BOOKMARK)}),this.$shareButton.onPressed(()=>{this.extensionHost.publish(E.SHOW_SHARE_DIALOGUE,this.$shareButton)}),this.$embedButton.onPressed(()=>{this.extensionHost.publish(E.SHOW_EMBED_DIALOGUE,this.$embedButton)}),this.$downloadButton.onPressed(()=>{this.extensionHost.publish(E.SHOW_DOWNLOAD_DIALOGUE,this.$downloadButton)}),this.$moreInfoButton.onPressed(()=>{this.extensionHost.publish(E.SHOW_MOREINFO_DIALOGUE,this.$moreInfoButton)}),this.onAccessibleClick(this.$fullScreenBtn,i=>{i.preventDefault(),this.extensionHost.publish(w.TOGGLE_FULLSCREEN)},!0),R.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()}updateMinimisedButtons(){if(R.getBool(this.options.minimiseButtons,!1)){this.$options.addClass("minimiseButtons");return}this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")}updateMoreInfoButton(){}updateOpenButton(){R.getBool(this.options.openEnabled,!1)&&K.isInIFrame()?this.$openButton.show():this.$openButton.hide()}updateFullScreenButton(){if(!R.getBool(this.options.fullscreenEnabled,!0)||!K.supportsFullscreen()){this.$fullScreenBtn.hide();return}this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),z(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),z(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen))}updateEmbedButton(){this.extension.helper.isUIEnabled("embed")&&R.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()}updateShareButton(){this.extension.helper.isUIEnabled("share")&&R.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()}updateDownloadButton(){R.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()}updateFeedbackButton(){R.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()}updateBookmarkButton(){R.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()}resize(){super.resize()}};var pt=class{constructor(i,a){this.message=i;this.actions=a}};var Ot=class{constructor(){}};var At=class{constructor(i){this.extension=i}Get(i){switch(i.informationType){case Z.AUTH_CORS_ERROR:return new pt(this.extension.data.config.content.authCORSError,[]);case Z.DEGRADED_RESOURCE:let a=[],u=new Ot,c=i.param.loginService.getConfirmLabel();c||(c=this.extension.data.config.content.fallbackDegradedLabel||"login"),u.label=c;let p=i.param;u.action=()=>{p.authHoldingPage=window.open("","_blank"),this.extension.extensionHost.publish(E.HIDE_INFORMATION),this.extension.extensionHost.publish(E.OPEN_EXTERNAL_RESOURCE,[[p]])},a.push(u);let s=i.param.loginService.getServiceLabel();return s||(s=this.extension.data.config.content.fallbackDegradedMessage),new pt(s,a)}}};var st=window.$,te=class extends D{constructor(i){super(i,!1,!1)}create(){this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(E.SHOW_INFORMATION,i=>{this.showInformation(Array.isArray(i)?i[0]:i)}),this.extensionHost.subscribe(E.HIDE_INFORMATION,()=>{this.hideInformation()}),this.$options=st('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=st('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=st('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=st('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=st(`
          <button class="btn imageBtn settings" tabindex="0" title="${this.content.settings}">
            <i class="uv-icon-settings" aria-hidden="true"></i>
          </button>
        `),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=st('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",i=>{i.preventDefault(),this.extensionHost.publish(E.HIDE_INFORMATION)}),this.$localeToggleButton.on("click",()=>{this.extension.changeLocale(String(this.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(E.SHOW_SETTINGS_DIALOGUE,this.$settingsButton)}),R.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()}updateLocaleToggle(){if(!this.localeToggleIsVisible()){this.$localeToggleButton.hide();return}let i=this.extension.getAlternateLocale(),a=i.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",i.name),this.$localeToggleButton.attr("title",i.label),this.$localeToggleButton.text(a)}updateSettingsButton(){R.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()}localeToggleIsVisible(){let i=this.extension.data.locales;return i?i.length>1&&R.getBool(this.options.localeToggleEnabled,!1):!1}showInformation(i){let a=new At(this.extension);if(this.information=a.Get(i),!!this.information){var u=this.$informationBox.find(".message");u.html(this.information.message).find("a").attr("target","_top");var c=this.$informationBox.find(".actions");c.empty();for(let p=0;p<this.information.actions.length;p++){let s=this.information.actions[p],v=st('<a href="#" class="btn btn-default">'+s.label+"</a>");v.on("click",s.action),c.append(v)}this.extensionHost.publish(E.MESSAGE_DISPLAYED,this.information),this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()}}hideInformation(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(E.UPDATE_SETTINGS,i)}resize(){super.resize();let a=this.$element.width()/2,u=this.$centerOptions.outerWidth(),c=a-u/2;if(this.$centerOptions.css({left:c}),U(this.$informationBox)){let p=this.$informationBox.find(".actions"),s=this.$informationBox.find(".message");s.width(Math.floor(this.$element.width())-Math.ceil(s.horizontalMargins())-Math.ceil(p.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),this.information&&s.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()}};var et=window.$,ut=class extends D{constructor(i){super(i,!1,!0);this.isExpanded=!1;this.isFullyExpanded=!1;this.isUnopened=!0;this.autoToggled=!1;this.expandFullEnabled=!0;this.reducedAnimation=!1}create(){super.create(),this.$top=et('<div class="top"></div>'),this.$element.append(this.$top),this.$title=et('<h2 class="title"></h2>'),this.$top.append(this.$title),this.$expandFullButton=et('<a class="expandFullButton" tabindex="0"></a>'),this.$top.append(this.$expandFullButton),R.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=et('<div role="button" class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=et('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=et('<a role="button" class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=et('<a class="title"></a>'),this.$closed.append(this.$closedTitle),this.$main=et('<div class="main"></div>'),this.$element.append(this.$main),this.onAccessibleClick(this.$expandButton,()=>{this.toggle()}),this.$expandFullButton.on("click",()=>{this.expandFull()}),this.$closedTitle.on("click",()=>{this.toggle()}),this.$title.on("click",()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.onAccessibleClick(this.$collapseButton,()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.$top.hide(),this.$main.hide(),this.extensionHost.subscribe(E.SETTINGS_CHANGE,i=>{this.reducedAnimation=i.reducedAnimation||!1})}init(){super.init()}setTitle(i){this.$title.text(i),this.$closedTitle.text(i)}toggle(i){i?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.reducedAnimation?(this.$element.css("width",this.getTargetWidth()),this.$element.css("left",this.getTargetLeft()),this.toggled()):this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,()=>{this.toggled()})}toggled(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1}expandFull(){this.isExpanded||this.toggled();var i=this.getFullTargetWidth(),a=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:i,left:a},this.options.panelAnimationDuration,()=>{this.expandFullFinish()})}collapseFull(){var i=this.getTargetWidth(),a=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:i,left:a},this.options.panelAnimationDuration,()=>{this.collapseFullFinish()})}getTargetWidth(){return 0}getTargetLeft(){return 0}getFullTargetWidth(){return 0}getFullTargetLeft(){return 0}toggleStart(){}toggleFinish(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()}expandFullStart(){}expandFullFinish(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()}collapseFullStart(){}collapseFullFinish(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()}focusExpandButton(){setTimeout(()=>{this.$expandButton.focus()},1)}focusExpandFullButton(){setTimeout(()=>{this.$expandFullButton.focus()},1)}focusCollapseButton(){setTimeout(()=>{this.$collapseButton.focus()},1)}resize(){super.resize(),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))}};var Lt=class extends ut{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth)}init(){super.init(),R.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.extensionHost.subscribe(E.TOGGLE_EXPAND_RIGHT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}getTargetWidth(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth}getTargetLeft(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(E.OPEN_RIGHT_PANEL):this.extensionHost.publish(E.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})}resize(){super.resize(),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})}};var ft=X(zt()),ee=window.$,ie=class extends Lt{constructor(i){super(i)}create(){this.setConfig("moreInfoRightPanel"),super.create(),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(E.RANGE_CHANGE,()=>{this.databind()}),this.setTitle(this.config.content.title),this.$metadata=ee('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new ft.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",i=>{let a=j.getHashParameterFromString("rid",i);if(a){let c=this.extension.helper.getRangeById(a);c&&this.extensionHost.publish(E.RANGE_CHANGE,c)}let u=j.getHashParameterFromString("t",i);if(u!==null){let c=Number(u);Number.isNaN(c)||this.extensionHost.publish(E.CURRENT_TIME_CHANGE,c)}},!1)}toggleFinish(){super.toggleFinish(),this.databind()}databind(){this.metadataComponent.set(this._getData())}_getCurrentRange(){return this.extension.helper.getCurrentRange()}_getData(){let i=this.extension.getCurrentCanvases();return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:i,canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:R.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new Bt(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:ft.LimitType.LINES,limitToRange:R.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:a=>Q(a),showAllLanguages:this.config.options.showAllLanguages}}resize(){super.resize(),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())}};var rt;(function(l){l[l.TOP_LEFT=0]="TOP_LEFT",l[l.TOP_CENTER=1]="TOP_CENTER",l[l.TOP_RIGHT=2]="TOP_RIGHT",l[l.CENTER_LEFT=3]="CENTER_LEFT",l[l.CENTER=4]="CENTER",l[l.CENTER_RIGHT=5]="CENTER_RIGHT",l[l.BOTTOM_LEFT=6]="BOTTOM_LEFT",l[l.BOTTOM_CENTER=7]="BOTTOM_CENTER",l[l.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(rt||(rt={}));var gt=window.$,ne=class extends D{constructor(i){super(i,!1,!0);this.subtitleExpanded=!1;this.isAttributionOpen=!1;this.attributionPosition=rt.BOTTOM_LEFT;this.isAttributionLoaded=!1}create(){super.create(),this.$title=gt('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=gt(`<div class="subtitle">
                                <div class="wrapper">
                                    <button type="button" class="expand-btn" aria-label="Expand">
                                        <span aria-hidden="true">+</span>
                                    </button>
                                    <span class="text"></span>
                                </div>
                            </div>`),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=gt('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=gt(`
                                <div class="attribution">
                                  <div class="header">
                                    <div class="title"></div>
                                    <button type="button" class="close" aria-label="Close">
                                      <span aria-hidden="true">&#215;</span>
                                    </button>
                                  </div>
                                  <div class="main">
                                    <div class="attribution-text"></div>
                                    <div class="license"></div>
                                    <div class="logo"></div>
                                  </div>
                                </div>
        `),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",i=>{i.preventDefault(),this.closeAttribution()}),this.$subtitleExpand.on("click",i=>{i.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()}),R.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),R.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized(()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(E.RANGE_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(E.CANVAS_INDEX_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(E.MANIFEST_INDEX_CHANGE,()=>{this.updateRequiredStatement()})}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){if(this.isAttributionLoaded)return;let i=R.getBool(this.config.options.mostSpecificRequiredStatement,!1),a=i?this.extension.helper.getMostSpecificRequiredStatement():this.extension.helper.getRequiredStatement(),u=R.getBool(this.options.requiredStatementEnabled,!0);if(!a||!a.value||!u)return;this.openAttribution();let c=this.$attribution.find(".title"),p=this.$attribution.find(".attribution-text"),s=this.$attribution.find(".license"),v=this.$attribution.find(".logo");if(a.label){let f=Q(a.label);c.html(f)}else c.text(this.content.attribution);if(a.value){let f=Q(a.value);p.html(f);let l=()=>this.resize();p.find("img").one("load",()=>{this.resize()}).each(function(){this.complete&&l()}),p.find("img").one("error",()=>{l()}),p.targetBlank()}s.hide(),v.hide(),this.resize(),i||(this.isAttributionLoaded=!0)}resize(){super.resize();let i=U(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,a=U(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,u=Math.floor(this.$element.parent().width()-i-a);this.$element.css({left:i,width:u});let c,p;this.options&&this.options.titleEnabled===!1||!U(this.$title)?c=0:c=this.$title.outerHeight(!0),this.options&&this.options.subtitleEnabled===!1||!U(this.$subtitle)?p=0:p=this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-c-p),this.$content.width(this.$element.width());let s=this.$attribution.find(".attribution-text");if(s.css("maxHeight",`calc(${this.$content.height()}px - 100px)`),s.css("overflow-y","auto"),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case rt.BOTTOM_LEFT:this.$attribution.css("bottom",0),this.$attribution.css("left",0);break;case rt.BOTTOM_RIGHT:this.$attribution.css("bottom",0),this.$attribution.css("right",0);break}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(Q(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}};var se=class extends ut{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth),this.extensionHost.subscribe(E.TOGGLE_EXPAND_LEFT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}init(){super.init(),R.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)}getTargetWidth(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth}getFullTargetWidth(){return this.$element.parent().width()}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(E.OPEN_LEFT_PANEL):this.extensionHost.publish(E.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})}resize(){super.resize(),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())}};var Y=window.$,oe=class extends F{constructor(i){super(i)}create(){this.setConfig("settingsDialogue"),super.create(),this.openCommand=E.SHOW_SETTINGS_DIALOGUE,this.closeCommand=E.HIDE_SETTINGS_DIALOGUE;let i;this.extensionHost.subscribe(this.openCommand,a=>{i=a,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.$title=Y('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$scroll=Y('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=Y('<div class="version"></div>'),this.$content.append(this.$version),this.$website=Y('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=Y('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=Y('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=Y('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this._createAccessibilityMenu(),this.$element.hide()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(E.UPDATE_SETTINGS,i)}open(){super.open(),this.$version.text("v"+process.env.PACKAGE_VERSION)}_createLocalesMenu(){let i=this.extension.data.locales;if(i&&i.length>1){for(let a=0;a<i.length;a++){let u=i[a];this.$localeDropDown.append('<option value="'+u.name+'">'+u.label+"</option>")}this.$localeDropDown.val(i[0].name)}else this.$locale.hide();this.$localeDropDown.change(()=>{this.extension.changeLocale(this.$localeDropDown.val())})}resize(){super.resize()}_createAccessibilityMenu(){this.$reducedAnimation=Y('<div class="setting reducedAnimation"></div>'),this.$scroll.append(this.$reducedAnimation),this.$reducedAnimationCheckbox=Y('<input id="reducedAnimation" type="checkbox" tabindex="0" />'),this.$reducedAnimation.append(this.$reducedAnimationCheckbox),this.$reducedAnimationLabel=Y('<label for="reducedAnimation">'+this.content.reducedMotion+"</label>"),this.$reducedAnimation.append(this.$reducedAnimationLabel),this.$reducedAnimationCheckbox.change(()=>{let i={};this.$reducedAnimationCheckbox.is(":checked")?i.reducedAnimation=!0:i.reducedAnimation=!1,this.updateSettings(i)})}};var B=window.$,re=class extends F{constructor(i){super(i);this.aspectRatio=.75;this.isEmbedViewVisible=!1;this.isShareViewVisible=!1;this.maxWidth=8e3;this.maxHeight=this.maxWidth*this.aspectRatio;this.minWidth=200;this.minHeight=this.minWidth*this.aspectRatio;this.shareManifestsEnabled=!1}create(){this.setConfig("shareDialogue"),super.create(),this.openCommand=E.SHOW_SHARE_DIALOGUE,this.closeCommand=E.HIDE_SHARE_DIALOGUE,this.shareManifestsEnabled=this.options.shareManifestsEnabled||!1;let i;this.extensionHost.subscribe(this.openCommand,u=>{i=u,this.open(u),this.isShareAvailable()?this.openShareView():this.openEmbedView()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.extensionHost.subscribe(E.SHOW_EMBED_DIALOGUE,u=>{this.open(u),this.openEmbedView()}),this.$tabs=B('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=B('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),this.$tabs.append(this.$shareButton),this.$embedButton=B('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),this.$tabs.append(this.$embedButton),this.$tabsContent=B('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=B('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=B('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=B('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=B('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=B(`<input class="shareInput" type="text" readonly="readonly" aria-label="${this.content.shareUrl}"/>`),this.$shareView.append(this.$shareInput),this.$shareFrame=B('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=B('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=B('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=B(`<input class="code" type="text" readonly="readonly" aria-label="${this.content.embed}"/>`),this.$embedView.append(this.$code),this.$customSize=B('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=B('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=B('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=B('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=B('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=B('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);let a=this.extension.getIIIFShareUrl(this.shareManifestsEnabled);this.shareManifestsEnabled&&(this.$iiifButton=B('<a class="imageBtn iiif" href="'+a+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton)),this.$termsOfUseButton=B('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",u=>vt.numericalInput(u)),this.$heightInput.on("keydown",u=>vt.numericalInput(u)),this.$shareInput.focus(function(){B(this).select()}),this.$code.focus(function(){B(this).select()}),this.onAccessibleClick(this.$shareButton,()=>{this.openShareView()}),this.onAccessibleClick(this.$embedButton,()=>{this.openEmbedView()}),this.$customSizeDropDown.change(()=>{this.update()}),this.$widthInput.change(()=>{this.updateHeightRatio(),this.update()}),this.$heightInput.change(()=>{this.updateWidthRatio(),this.update()}),this.onAccessibleClick(this.$termsOfUseButton,()=>{this.extensionHost.publish(E.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.update()}open(i){super.open(i),this.update()}getShareUrl(){return this.extension.getShareUrl()}isShareAvailable(){return!!this.getShareUrl()}update(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();let i=this.getSelectedSize();i.val()==="custom"?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(i.data("width")),this.currentHeight=Number(i.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()}updateShareOptions(){let i=this.getShareUrl();i&&(this.$shareInput.val(i),this.$shareLink.prop("href",i),this.$shareLink.text(i)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())}updateInstructions(){R.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())}getSelectedSize(){return this.$customSizeDropDown.find(":selected")}updateWidthRatio(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))}updateHeightRatio(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))}updateShareFrame(){let i=this.extension.helper.getShareServiceUrl();!i||(R.getBool(this.config.options.shareFrameEnabled,!0)&&i?(this.$shareFrame.prop("src",i),this.$shareFrame.show()):this.$shareFrame.hide())}updateTermsOfUseButton(){let i=this.extension.helper.getRequiredStatement();R.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&i&&i.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}openShareView(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()}openEmbedView(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()}close(){super.close()}getViews(){return this.$tabsContent.find(".view")}equaliseViewHeights(){this.getViews().equaliseHeight(!0)}resize(){this.equaliseViewHeights(),this.setDockedPosition()}};export{D as a,rt as b,ne as c,F as d,k as e,Zt as f,se as g,Kt as h,te as i,zt as j,ie as k,oe as l,re as m};
